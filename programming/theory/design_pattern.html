---
title: "Design Pattern"
---
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Design Pattern</title>
<!-- 2017-06-05 Mon 15:21 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../../styles/readtheorg/css/font.css"/>
<link rel="stylesheet" type="text/css" href="../../styles/readtheorg/css/readtheorg.css"/>
<link rel="stylesheet" type="text/css" href="../../styles/readtheorg/css/htmlize.css"/>
<script type="text/javascript" src="../../styles/readtheorg/js/jquery.min.js"></script>
<script type="text/javascript" src="../../styles/readtheorg/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Design Pattern</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. 原则</a>
<ul>
<li><a href="#sec-1-1">1.1. 开闭原则</a></li>
<li><a href="#sec-1-2">1.2. 里氏代换原则</a></li>
<li><a href="#sec-1-3">1.3. 接口隔离原则</a></li>
<li><a href="#sec-1-4">1.4. 迪米特法则</a></li>
<li><a href="#sec-1-5">1.5. 合成复用原则</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Creational</a>
<ul>
<li><a href="#sec-2-1">2.1. Abstract Factory</a>
<ul>
<li><a href="#sec-2-1-1">2.1.1. 示例</a></li>
</ul>
</li>
<li><a href="#sec-2-2">2.2. 工厂方法</a></li>
<li><a href="#sec-2-3">2.3. 单例</a></li>
<li><a href="#sec-2-4">2.4. Builder</a>
<ul>
<li><a href="#sec-2-4-1">2.4.1. 示例</a></li>
</ul>
</li>
<li><a href="#sec-2-5">2.5. 原型</a></li>
</ul>
</li>
<li><a href="#sec-3">3. Structural</a>
<ul>
<li><a href="#sec-3-1">3.1. Adapter</a>
<ul>
<li><a href="#sec-3-1-1">3.1.1. 关系</a></li>
<li><a href="#sec-3-1-2">3.1.2. 示例</a></li>
</ul>
</li>
<li><a href="#sec-3-2">3.2. Bridge</a>
<ul>
<li><a href="#sec-3-2-1">3.2.1. 问题</a></li>
<li><a href="#sec-3-2-2">3.2.2. 特点</a></li>
<li><a href="#sec-3-2-3">3.2.3. 关系</a></li>
<li><a href="#sec-3-2-4">3.2.4. 示例</a></li>
</ul>
</li>
<li><a href="#sec-3-3">3.3. Composite</a>
<ul>
<li><a href="#sec-3-3-1">3.3.1. 特点</a></li>
<li><a href="#sec-3-3-2">3.3.2. 关系</a></li>
<li><a href="#sec-3-3-3">3.3.3. 示例</a></li>
</ul>
</li>
<li><a href="#sec-3-4">3.4. Decorator</a>
<ul>
<li><a href="#sec-3-4-1">3.4.1. 问题</a></li>
<li><a href="#sec-3-4-2">3.4.2. 特点</a></li>
<li><a href="#sec-3-4-3">3.4.3. 关系</a></li>
<li><a href="#sec-3-4-4">3.4.4. 示例</a></li>
</ul>
</li>
<li><a href="#sec-3-5">3.5. Proxy</a>
<ul>
<li><a href="#sec-3-5-1">3.5.1. 使用</a></li>
<li><a href="#sec-3-5-2">3.5.2. 特点</a></li>
<li><a href="#sec-3-5-3">3.5.3. 关系</a></li>
<li><a href="#sec-3-5-4">3.5.4. 示例</a></li>
</ul>
</li>
<li><a href="#sec-3-6">3.6. 外观</a>
<ul>
<li><a href="#sec-3-6-1">3.6.1. Java 示例</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-4">4. Behavioral</a>
<ul>
<li><a href="#sec-4-1">4.1. Chain of Responsibility</a>
<ul>
<li><a href="#sec-4-1-1">4.1.1. 特点</a></li>
<li><a href="#sec-4-1-2">4.1.2. 关系</a></li>
<li><a href="#sec-4-1-3">4.1.3. 示例</a></li>
</ul>
</li>
<li><a href="#sec-4-2">4.2. Iterator</a>
<ul>
<li><a href="#sec-4-2-1">4.2.1. 特点</a></li>
<li><a href="#sec-4-2-2">4.2.2. 关系</a></li>
<li><a href="#sec-4-2-3">4.2.3. 示例</a></li>
</ul>
</li>
<li><a href="#sec-4-3">4.3. 命令</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1. Java 示例</a></li>
</ul>
</li>
<li><a href="#sec-4-4">4.4. 观察者</a>
<ul>
<li><a href="#sec-4-4-1">4.4.1. Java 实现</a></li>
</ul>
</li>
<li><a href="#sec-4-5">4.5. 策略</a>
<ul>
<li><a href="#sec-4-5-1">4.5.1. Java 示例</a></li>
</ul>
</li>
<li><a href="#sec-4-6">4.6. 访问者</a></li>
</ul>
</li>
<li><a href="#sec-5">5. 依赖</a>
<ul>
<li><a href="#sec-5-1">5.1. 依赖注入</a></li>
<li><a href="#sec-5-2">5.2. 依赖反转</a></li>
</ul>
</li>
<li><a href="#sec-6">6. Quote</a></li>
<li><a href="#sec-7">7. 链接</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 原则</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> 开闭原则</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li>Open Close Principle
</li>
<li>对扩展开放，对修改关闭。
</li>
<li>在程序需要进行扩展的时候，不能去修改原有的代码，以实现热插拔的效果。
</li>
<li>关键步骤就是抽象化，而基类与子类的继承关系就是抽象化的具体实现。
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> 里氏代换原则</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li>Liskov Substitution Principle
</li>
<li>任何基类可以出现的地方，子类一定可以出现。
</li>
<li>继承复用的基石。
</li>
<li>只有当衍生类替换掉基类而软件单位的功能不受到影响时，基类才能真正被复用。
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> 接口隔离原则</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>Interface Segregation Principle）
</li>
<li>使用多个隔离的接口，比使用单个接口要好。
</li>
<li>降低类之间的耦合度。
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> 迪米特法则</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>Demeter Principle
</li>
<li>最少知道原则。
</li>
<li>一个实体应当尽量少地与其他实体之间发生相互作用，使得系统功能模块相对独立。
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> 合成复用原则</h3>
<div class="outline-text-3" id="text-1-5">
<ul class="org-ul">
<li>Composite Reuse Principle
</li>
<li>尽量使用合成、聚合，而不是继承。
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Creational</h2>
<div class="outline-text-2" id="text-2">
<p>
Creational patterns deal with class instantiation (object creation) mechanisms. The purpose is to create objects in a manner suitable to the situation, and avoid design problems or complexity.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Abstract Factory</th>
<th scope="col" class="left">抽象工厂</th>
<th scope="col" class="left">Creates an instance of several families of classes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">Builder</td>
<td class="left">建造者</td>
<td class="left">Separates object construction from representation</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Factory Method</td>
<td class="left">工厂方法</td>
<td class="left">Creates an instance of several derived classes</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Object Pool</td>
<td class="left">&#xa0;</td>
<td class="left">Avoid acquisition and release of resources by recycling objects</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Prototype</td>
<td class="left">原型</td>
<td class="left">A fully initialized instance to be copied or cloned</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Singleton</td>
<td class="left">单例</td>
<td class="left">A class of which only a single instance can exist</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Abstract Factory</h3>
<div class="outline-text-3" id="text-2-1">
<p>
The purpose of the Abstract Factory is to provide an interface for creating families of related objects, without specifying concrete classes. The Abstract Factory defines a Factory Method per product. Each Factory Method encapsulates the <code>new</code> operator and the concrete, platform-specific, product classes.
</p>

<p>
Client doesn't create platform objects directly, instead it instantiates the factory class which provides creation services for the entire platform family. The instantiation of factory class appears only once, which makes exchanging product families easy.
</p>

<ol class="org-ol">
<li>Decide if "platform independence" and creation services are the current source of pain.
</li>
<li>Map out a matrix of "platforms" versus "products".
</li>
<li>Define a factory interface that consists of a factory method per product.
</li>
<li>Define a factory derived class for each platform that encapsulates all references to the <code>new</code> operator.
</li>
<li>The client should retire all references to new, and use the factory methods to create the product objects.
</li>
</ol>


<div class="figure">
<p><img src="../images/design_pattern/03.svg" alt="03.svg" />
</p>
</div>

<p>
工厂方法模式中，类的创建依赖工厂类，如果想要扩展程序，必须对工厂类进行修改，这违背了闭包原则；抽象工厂模式使用多个继承自同一工厂接口的工厂类，一旦需要增加新的功能，可以直接增加新的工厂类。
</p>
</div>

<div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1"><span class="section-number-4">2.1.1</span> 示例</h4>
<div class="outline-text-4" id="text-2-1-1">
<div class="org-src-container">

<pre class="src src-java"><span class="org-comment-delimiter">// </span><span class="org-comment">&#20135;&#21697;&#25509;&#21475;</span>
<span class="org-keyword">public</span> <span class="org-keyword">interface</span> <span class="org-type">Sender</span> {
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">Send</span>();
}

<span class="org-comment-delimiter">// </span><span class="org-comment">&#20135;&#21697;&#23454;&#29616;</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">MailSender</span> <span class="org-keyword">implements</span> <span class="org-type">Sender</span> {
    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">Send</span>() {
        System.out.println(<span class="org-string">"this is mailsender!"</span>);
    }
}
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">SmsSender</span> <span class="org-keyword">implements</span> <span class="org-type">Sender</span> {
    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">Send</span>() {
        System.out.println(<span class="org-string">"this is sms sender!"</span>);
    }
}

<span class="org-comment-delimiter">// </span><span class="org-comment">&#24037;&#21378;&#25509;&#21475;</span>
<span class="org-keyword">public</span> <span class="org-keyword">interface</span> <span class="org-type">Provider</span> {
    <span class="org-keyword">public</span> <span class="org-type">Sender</span> <span class="org-function-name">produce</span>();
}

<span class="org-comment-delimiter">// </span><span class="org-comment">&#24037;&#21378;&#23454;&#29616;</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">SendMailFactory</span> <span class="org-keyword">implements</span> <span class="org-type">Provider</span> {
    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">Sender</span> <span class="org-function-name">produce</span>() {
        <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">MailSender</span>();
    }
}
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">SendSmsFactory</span> <span class="org-keyword">implements</span> <span class="org-type">Provider</span> {
    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">Sender</span> <span class="org-function-name">produce</span>() {
        <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">SmsSender</span>();
    }
}

<span class="org-comment-delimiter">// </span><span class="org-comment">&#20351;&#29992;</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Test</span> {
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">main</span>(<span class="org-type">String</span>[] <span class="org-variable-name">args</span>) {
        <span class="org-type">Provider</span> <span class="org-variable-name">provider</span> = <span class="org-keyword">new</span> <span class="org-type">SendMailFactory</span>();
        <span class="org-type">Sender</span> <span class="org-variable-name">sender</span> = provider.produce();
        <span class="org-constant">sender</span>.Send();
    }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> 工厂方法</h3>
<div class="outline-text-3" id="text-2-2">

<div class="figure">
<p><img src="../images/design_pattern/02.png" alt="02.png" />
</p>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" class="no-border">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left"><b>应用场景：</b></th>
<th scope="col" class="left">大量的对象需要创建，并且具有共同的接口，可以被多态调用</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><b>例子：</b></td>
<td class="left">内存池、线程池、连接池等池化技术</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">Unix 下的硬件都工厂化为文件，提供 read/write 等方法操作任意设备的 I/O</td>
</tr>
</tbody>
</table>

<hr  />

<div class="org-src-container">
<label class="org-src-name">普通工厂方法</label>
<pre class="src src-java"><span class="org-comment-delimiter">// </span><span class="org-comment">&#20135;&#21697;&#25509;&#21475;</span>
<span class="org-keyword">public</span> <span class="org-keyword">interface</span> <span class="org-type">Sender</span> {
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">Send</span>();
}

<span class="org-comment-delimiter">// </span><span class="org-comment">&#20135;&#21697;&#23454;&#29616;</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">MailSender</span> <span class="org-keyword">implements</span> <span class="org-type">Sender</span> {
    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">Send</span>() {
        System.out.println(<span class="org-string">"this is mailsender!"</span>);
    } 
}
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">SmsSender</span> <span class="org-keyword">implements</span> <span class="org-type">Sender</span> {
    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">Send</span>() {
        System.out.println(<span class="org-string">"this is sms sender!"</span>);
    }
}

<span class="org-comment-delimiter">// </span><span class="org-comment">&#24037;&#21378;&#31867;</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">SendFactory</span> {
    <span class="org-keyword">public</span> <span class="org-type">Sender</span> <span class="org-function-name">produce</span>(<span class="org-type">String</span> <span class="org-variable-name">type</span>) {
        <span class="org-keyword">if</span> (<span class="org-string">"mail"</span>.equals(type)) {
            <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">MailSender</span>();
        } <span class="org-keyword">else</span> <span class="org-keyword">if</span> (<span class="org-string">"sms"</span>.equals(type)) {
            <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">SmsSender</span>();
        } <span class="org-keyword">else</span> {
            System.out.println(<span class="org-string">"&#35831;&#36755;&#20837;&#27491;&#30830;&#30340;&#31867;&#22411;!"</span>);
            <span class="org-keyword">return</span> <span class="org-constant">null</span>;
        }
    }
}

<span class="org-comment-delimiter">// </span><span class="org-comment">&#20351;&#29992;</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">FactoryTest</span> {
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">main</span>(<span class="org-type">String</span>[] <span class="org-variable-name">args</span>) {
        <span class="org-type">SendFactory</span> <span class="org-variable-name">factory</span> = <span class="org-keyword">new</span> <span class="org-type">SendFactory</span>();
        <span class="org-type">Sender</span> <span class="org-variable-name">sender</span> = factory.produce(<span class="org-string">"sms"</span>);
        <span class="org-constant">sender</span>.Send();
    }
}
</pre>
</div>

<hr  />

<div class="org-src-container">
<label class="org-src-name">多个工厂方法：定义多个而不是一个工厂方法，每个工厂方法只返回一个特定的类的实例</label>
<pre class="src src-java"><span class="org-comment-delimiter">// </span><span class="org-comment">&#24037;&#21378;&#31867;</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">SendFactory</span> {
    <span class="org-keyword">public</span> <span class="org-type">Sender</span> <span class="org-function-name">produceMail</span>() {
        <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">MailSender</span>();
    }
    <span class="org-keyword">public</span> <span class="org-type">Sender</span> <span class="org-function-name">produceSms</span>() {
        <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">SmsSender</span>();
    }
}

<span class="org-comment-delimiter">// </span><span class="org-comment">&#20351;&#29992;</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">FactoryTest</span> {
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">main</span>(<span class="org-type">String</span>[] <span class="org-variable-name">args</span>) {
        <span class="org-type">SendFactory</span> <span class="org-variable-name">factory</span> = <span class="org-keyword">new</span> <span class="org-type">SendFactory</span>();
        <span class="org-type">Sender</span> <span class="org-variable-name">sender</span> = factory.produce(<span class="org-string">"sms"</span>);
        <span class="org-constant">sender</span>.Send();
    }
}
</pre>
</div>

<hr  />

<div class="org-src-container">
<label class="org-src-name">静态工厂方法：将多个工厂方法定义为静态方法，不需要创建工厂实例就可以调用</label>
<pre class="src src-java"><span class="org-comment-delimiter">// </span><span class="org-comment">&#24037;&#21378;&#31867;</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">SendFactory</span> {
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">Sender</span> <span class="org-function-name">produceMail</span>() {
        <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">MailSender</span>();
    }
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">Sender</span> <span class="org-function-name">produceSms</span>() {
        <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">SmsSender</span>();
    }
}

<span class="org-comment-delimiter">// </span><span class="org-comment">&#20351;&#29992;</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">FactoryTest</span> {
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">main</span>(<span class="org-type">String</span>[] <span class="org-variable-name">args</span>) {    
        <span class="org-type">Sender</span> <span class="org-variable-name">sender</span> = SendFactory.produceMail();
        <span class="org-constant">sender</span>.Send();
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> 单例</h3>
<div class="outline-text-3" id="text-2-3">

<div class="figure">
<p><img src="../images/design_pattern/04.png" alt="04.png" />
</p>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" class="no-border">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left"><b>应用场景：</b></th>
<th scope="col" class="left">需要保证某个类只有一个实例存在</th>
</tr>

<tr>
<th scope="col" class="left">&#xa0;</th>
<th scope="col" class="left">减少某些大型的类的对象创建产生的系统开销</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><b>例子：</b></td>
<td class="left">交易所的核心交易引擎</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">全局变量</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">单例进程（通过锁文件实现）</td>
</tr>
</tbody>
</table>

<hr  />

<div class="org-src-container">

<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Singleton</span> {

    <span class="org-comment-delimiter">/* </span><span class="org-comment">&#25345;&#26377;&#31169;&#26377;&#38745;&#24577;&#23454;&#20363;&#65292;&#38450;&#27490;&#34987;&#24341;&#29992;&#65292;&#27492;&#22788;&#36171;&#20540;&#20026;null&#65292;&#30446;&#30340;&#26159;&#23454;&#29616;&#24310;&#36831;&#21152;&#36733; */</span>
    <span class="org-keyword">private</span> <span class="org-keyword">static</span> <span class="org-type">Singleton</span> <span class="org-variable-name">instance</span> = <span class="org-constant">null</span>;

    <span class="org-comment-delimiter">/* </span><span class="org-comment">&#31169;&#26377;&#26500;&#36896;&#26041;&#27861;&#65292;&#38450;&#27490;&#34987;&#23454;&#20363;&#21270; */</span>
    <span class="org-keyword">private</span> Singleton() {
    }

    <span class="org-comment-delimiter">/* </span><span class="org-comment">&#38745;&#24577;&#24037;&#31243;&#26041;&#27861;&#65292;&#21019;&#24314;&#23454;&#20363; */</span>
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">Singleton</span> <span class="org-function-name">getInstance</span>() {
        <span class="org-keyword">if</span> (instance == <span class="org-constant">null</span>) {
            instance = <span class="org-keyword">new</span> <span class="org-type">Singleton</span>();
        }
        <span class="org-keyword">return</span> instance;
    }

    <span class="org-comment-delimiter">/* </span><span class="org-comment">&#22914;&#26524;&#35813;&#23545;&#35937;&#34987;&#29992;&#20110;&#24207;&#21015;&#21270;&#65292;&#21487;&#20197;&#20445;&#35777;&#23545;&#35937;&#22312;&#24207;&#21015;&#21270;&#21069;&#21518;&#20445;&#25345;&#19968;&#33268; */</span>
    <span class="org-keyword">public</span> <span class="org-type">Object</span> <span class="org-function-name">readResolve</span>() {
        <span class="org-keyword">return</span> instance;
    }
}
</pre>
</div>

<hr  />

<p>
多线程环境下，第一次创建对象时需要加锁
</p>
<div class="org-src-container">

<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">Singleton</span> <span class="org-function-name">getInstance</span>() {
    <span class="org-keyword">if</span> (instance == <span class="org-constant">null</span>) {
        <span class="org-keyword">synchronized</span> (instance) {
            <span class="org-keyword">if</span> (instance == <span class="org-constant">null</span>) {
                instance = <span class="org-keyword">new</span> <span class="org-type">Singleton</span>();
            }
        }
    }
    <span class="org-keyword">return</span> instance;
}
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> Builder</h3>
<div class="outline-text-3" id="text-2-4">

<div class="figure">
<p><img src="../images/design_pattern/05.svg" alt="05.svg" />
</p>
</div>

<p>
将（抽象）工厂模式和使用结合起来，工厂模式关注的是创建单个产品，建造者模式则关注创建多个（复合）对象。
</p>
</div>

<div id="outline-container-sec-2-4-1" class="outline-4">
<h4 id="sec-2-4-1"><span class="section-number-4">2.4.1</span> 示例</h4>
<div class="outline-text-4" id="text-2-4-1">
<div class="org-src-container">

<pre class="src src-java"><span class="org-comment-delimiter">// </span><span class="org-comment">&#20135;&#21697;&#25509;&#21475;</span>
<span class="org-keyword">public</span> <span class="org-keyword">interface</span> <span class="org-type">Sender</span> {
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">Send</span>();
}

<span class="org-comment-delimiter">// </span><span class="org-comment">&#20135;&#21697;&#23454;&#29616;</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">MailSender</span> <span class="org-keyword">implements</span> <span class="org-type">Sender</span> {
    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">Send</span>() {
        System.out.println(<span class="org-string">"this is mailsender!"</span>);
    }
}
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">SmsSender</span> <span class="org-keyword">implements</span> <span class="org-type">Sender</span> {
    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">Send</span>() {
        System.out.println(<span class="org-string">"this is sms sender!"</span>);
    }
}

<span class="org-comment-delimiter">// </span><span class="org-comment">&#24314;&#36896;&#32773;</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Builder</span> {
    <span class="org-keyword">private</span> <span class="org-type">List</span>&lt;Sender&gt; list = <span class="org-keyword">new</span> <span class="org-type">ArrayList</span>&lt;Sender&gt;();

    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">produceMailSender</span>(<span class="org-type">int</span> <span class="org-variable-name">count</span>) {
        <span class="org-keyword">for</span>(<span class="org-type">int</span> <span class="org-variable-name">i</span>=0; i&lt;count; i++){
            list.add(<span class="org-keyword">new</span> <span class="org-type">MailSender</span>());
        }
    }
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">produceSmsSender</span>(<span class="org-type">int</span> <span class="org-variable-name">count</span>) {
        <span class="org-keyword">for</span>(<span class="org-type">int</span> <span class="org-variable-name">i</span>=0; i&lt;count; i++){
            list.add(<span class="org-keyword">new</span> <span class="org-type">SmsSender</span>());
        }
    }
}

<span class="org-comment-delimiter">// </span><span class="org-comment">&#20351;&#29992;</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Test</span> {
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">main</span>(<span class="org-type">String</span>[] <span class="org-variable-name">args</span>) {
        <span class="org-type">Builder</span> <span class="org-variable-name">builder</span> = <span class="org-keyword">new</span> <span class="org-type">Builder</span>();
        builder.produceMailSender(10);
    }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> 原型</h3>
<div class="outline-text-3" id="text-2-5">

<div class="figure">
<p><img src="../images/design_pattern/06.png" alt="06.png" />
</p>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" class="no-border">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left"><b>应用场景：</b></th>
<th scope="col" class="left">将一个对象作为原型，对其进行复制、克隆，产生一个类似的新对象</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><b>例子：</b></td>
<td class="left">Unix fork 进程</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">GitHub fork 代码库</td>
</tr>
</tbody>
</table>

<hr  />

<div class="org-src-container">

<pre class="src src-java"><span class="org-comment-delimiter">// </span><span class="org-comment">&#21407;&#22411;&#31867;</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">&#23454;&#29616; Cloneable &#25509;&#21475;&#65292;&#35206;&#20889; clone() &#26041;&#27861;</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Prototype</span> <span class="org-keyword">implements</span> <span class="org-type">Cloneable</span> {
    <span class="org-keyword">public</span> <span class="org-type">Object</span> <span class="org-function-name">clone</span>() <span class="org-keyword">throws</span> <span class="org-type">CloneNotSupportedException</span> {
        <span class="org-type">Prototype</span> <span class="org-variable-name">proto</span> = (Prototype) <span class="org-keyword">super</span>.clone();
        <span class="org-keyword">return</span> proto;
    }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Structural</h2>
<div class="outline-text-2" id="text-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Adapter</th>
<th scope="col" class="left">适配器</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">Bridge</td>
<td class="left">桥接</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Composite</td>
<td class="left">组合</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Decorator</td>
<td class="left">装饰器</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Facade</td>
<td class="left">外观</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Flyweight</td>
<td class="left">享元</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Proxy</td>
<td class="left">代理</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Adapter</h3>
<div class="outline-text-3" id="text-3-1">

<div class="figure">
<p><img src="../images/design_pattern/09.png" alt="09.png" />
</p>
</div>

<p>
将旧接口转换（封装）成客户端期望的新接口，消除由于接口不匹配造成的兼容性问题。
</p>
</div>

<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span> 关系</h4>
<div class="outline-text-4" id="text-3-1-1">
</div><ol class="org-ol"><li>Bridge<br  /><div class="outline-text-5" id="text-3-1-1-1">
<ul class="org-ul">
<li>Adapter makes things work after they're designed. Bridge makes them work before they are.
</li>
<li>Bridge is designed up-front to let the abstraction and the implementation vary independently. Adapter is retrofitted to make unrelated classes work together.
</li>
</ul>
</div>
</li>
<li>Decorator<br  /><div class="outline-text-5" id="text-3-1-1-2">
<ul class="org-ul">
<li>Adapter provides a different interface to its subject. Decorator provides an enhanced interface.
</li>
<li>Adapter is meant to change the interface of an existing object. Decorator enhances another object without changing its interface.
</li>
<li>Decorator is more transparent to the application than an adapter is.
</li>
<li>Decorator supports recursive composition, which isn't possible with pure Adapters.
</li>
</ul>
</div>
</li>
<li>Facade<br  /><div class="outline-text-5" id="text-3-1-1-3">
<ul class="org-ul">
<li>Facade defines a new interface, whereas Adapter reuses an old interface. Adapter makes two existing interfaces work together as opposed to defining an entirely new one.
</li>
</ul>
</div>
</li>
<li>Proxy<br  /><div class="outline-text-5" id="text-3-1-1-4">
<ul class="org-ul">
<li>Adapter provides a different interface to its subject. Proxy provides the same interface. 
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-3-1-2" class="outline-4">
<h4 id="sec-3-1-2"><span class="section-number-4">3.1.2</span> 示例</h4>
<div class="outline-text-4" id="text-3-1-2">
<div class="org-src-container">
<label class="org-src-name"><code>LegacyRectangle</code> uses coordinates while client expects to use coordinates and dimensions.</label>
<pre class="src src-cpp"><span class="org-keyword">typedef</span> <span class="org-type">int</span> <span class="org-type">Coordinate</span>;
<span class="org-keyword">typedef</span> <span class="org-type">int</span> <span class="org-type">Dimension</span>;

<span class="org-comment-delimiter">// </span><span class="org-comment">Desired interface</span>
<span class="org-keyword">class</span> <span class="org-type">Rectangle</span> {
<span class="org-keyword">public</span>:
    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">draw</span>() = 0;
};

<span class="org-comment-delimiter">// </span><span class="org-comment">Legacy component</span>
<span class="org-keyword">class</span> <span class="org-type">LegacyRectangle</span> {
    <span class="org-type">Coordinate</span> <span class="org-variable-name">_x1</span>, <span class="org-variable-name">_y1</span>, <span class="org-variable-name">_x2</span>, <span class="org-variable-name">_y2</span>;

<span class="org-keyword">public</span>:
    <span class="org-function-name">LegacyRectangle</span>(<span class="org-type">Coordinate</span> <span class="org-variable-name">x1</span>, <span class="org-type">Coordinate</span> <span class="org-variable-name">y1</span>, <span class="org-type">Coordinate</span> <span class="org-variable-name">x2</span>, <span class="org-type">Coordinate</span> <span class="org-variable-name">y2</span>): _x1(x1), <span class="org-type">_y1</span>(<span class="org-variable-name">y1</span>), <span class="org-type">_x2</span>(<span class="org-variable-name">x2</span>), _y2(y2) {}

    <span class="org-type">void</span> <span class="org-function-name">oldDraw</span>() {
        cout &lt;&lt; <span class="org-string">"Rectangle: ("</span> &lt;&lt; _x1 &lt;&lt; <span class="org-string">","</span> &lt;&lt; _y1 &lt;&lt; <span class="org-string">") =&gt; ("</span> &lt;&lt; _x2 &lt;&lt; <span class="org-string">","</span> &lt;&lt; _y2 &lt;&lt; <span class="org-string">")"</span> &lt;&lt; endl;
    }
};

<span class="org-comment-delimiter">// </span><span class="org-comment">Adapter wrapper</span>
<span class="org-keyword">class</span> <span class="org-type">RectangleAdapter</span>: <span class="org-keyword">public</span> <span class="org-type">Rectangle</span>, <span class="org-keyword">private</span> <span class="org-type">LegacyRectangle</span> {
<span class="org-keyword">public</span>:
    <span class="org-function-name">RectangleAdapter</span>(<span class="org-type">Coordinate</span> <span class="org-variable-name">x</span>, <span class="org-type">Coordinate</span> <span class="org-variable-name">y</span>, <span class="org-type">Dimension</span> <span class="org-variable-name">w</span>, <span class="org-type">Dimension</span> <span class="org-variable-name">h</span>): LegacyRectangle(x, y, x + w, y + h) {}

    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">draw</span>() {
        oldDraw();
    }
};

<span class="org-type">int</span> <span class="org-function-name">main</span>() {
    <span class="org-type">Rectangle</span> *<span class="org-variable-name">r</span> = <span class="org-keyword">new</span> <span class="org-type">RectangleAdapter</span>(120, 200, 60, 40);
    r-&gt;draw();
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Bridge</h3>
<div class="outline-text-3" id="text-3-2">

<div class="figure">
<p><img src="../images/design_pattern/10.png" alt="10.png" />
</p>
</div>

<ul class="org-ul">
<li><span class="underline">Decouple an abstraction from its implementation</span> so that the two can vary independently.
</li>
<li>Publish interface in an inheritance hierarchy, and bury implementation in its own inheritance hierarchy.
</li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" class="no-border">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left"><b>例子</b></td>
<td class="left">连接数据库的扩展，对外提供统一接口，内部为每个数据库提供各自的实现。</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-sec-3-2-1" class="outline-4">
<h4 id="sec-3-2-1"><span class="section-number-4">3.2.1</span> 问题</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
假设有两种线程调度器和两个平台，需要为每个平台分别实现两种调度器：
</p>


<div class="figure">
<p><img src="../images/design_pattern/12.svg" alt="12.svg" />
</p>
</div>

<p>
如果需要加入一个新的平台，类关系将变为：
</p>


<div class="figure">
<p><img src="../images/design_pattern/13.svg" alt="13.svg" />
</p>
</div>

<p>
桥接模式通过将抽象与实现解耦，将继承关系分为两部分：与平台无关的抽象，和与平台有关的实现：
</p>


<div class="figure">
<p><img src="../images/design_pattern/14.svg" alt="14.svg" />
</p>
</div>
</div>
</div>
<div id="outline-container-sec-3-2-2" class="outline-4">
<h4 id="sec-3-2-2"><span class="section-number-4">3.2.2</span> 特点</h4>
<div class="outline-text-4" id="text-3-2-2">
<ul class="org-ul">
<li>有两个正交（orthogonal）的、各自独立发展的维度，如：abstraction/platform，front-end/back-end，interface/implementation。
</li>
<li>接口（面向用户）基类有一个实现（向用户隐藏）基类的指针，使用时会指向实例化的实现类的对象。
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-2-3" class="outline-4">
<h4 id="sec-3-2-3"><span class="section-number-4">3.2.3</span> 关系</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
State, Strategy, Bridge (and to some degree Adapter) have similar solution structures. They all share elements of the "handle/body" idiom. They differ in intent, and solve different problems.
</p>
</div>

<ol class="org-ol"><li>Abstarct Factory<br  /><div class="outline-text-5" id="text-3-2-3-1">
<ul class="org-ul">
<li>If interface classes delegate the creation of their implementation classes (instead of creating/coupling themselves directly), then the design usually uses the Abstract Factory pattern to create the implementation objects.
</li>
</ul>
</div>
</li>
<li>Adapter<br  /><div class="outline-text-5" id="text-3-2-3-2">
<ul class="org-ul">
<li>Adapter makes things work after they're designed; Bridge makes them work before they are.
</li>
<li>Bridge is designed up-front to let the abstraction and the implementation vary independently. Adapter is retrofitted to make unrelated classes work together.
</li>
</ul>
</div>
</li>
<li>State<br  /><div class="outline-text-5" id="text-3-2-3-3">
<ul class="org-ul">
<li>The structure of State and Bridge are identical, except that Bridge admits hierarchies of envelope classes, whereas State allows only one.
</li>
<li>They solve different problems: State allows an object's behavior to change along with its state, while Bridge's intent is to decouple an abstraction from its implementation so that the two can vary independently.
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-3-2-4" class="outline-4">
<h4 id="sec-3-2-4"><span class="section-number-4">3.2.4</span> 示例</h4>
<div class="outline-text-4" id="text-3-2-4">
<div class="org-src-container">

<pre class="src src-cpp"><span class="org-comment-delimiter">/***** </span><span class="org-comment">Implementation *****/</span>

<span class="org-keyword">class</span> <span class="org-type">TimeImp</span> {
<span class="org-keyword">protected</span>:
    <span class="org-type">int</span> <span class="org-variable-name">hour</span>, <span class="org-variable-name">minute</span>;
<span class="org-keyword">public</span>:
    <span class="org-function-name">TimeImp</span>(<span class="org-type">int</span> <span class="org-variable-name">h</span>, <span class="org-type">int</span> <span class="org-variable-name">m</span>): hour(h), minute(m) {}
    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">tell</span>() = 0;
};

<span class="org-keyword">class</span> <span class="org-type">HumanTimeImp</span>: <span class="org-keyword">public</span> <span class="org-type">TimeImp</span> {
<span class="org-keyword">protected</span>:
    <span class="org-type">string</span> <span class="org-variable-name">ampm</span>;
<span class="org-keyword">public</span>:
    <span class="org-function-name">HumanTimeImp</span>(<span class="org-type">int</span> <span class="org-variable-name">h</span>, <span class="org-type">int</span> <span class="org-variable-name">m</span>): TimeImp(h, m) {
        <span class="org-keyword">if</span> (h &gt; 12)
            hour -= 12, ampm = <span class="org-string">"PM"</span>;
        <span class="org-keyword">else</span>
            ampm = <span class="org-string">"AM"</span>;
    }
    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">tell</span>() {
        cout &lt;&lt; <span class="org-string">"Time is "</span> &lt;&lt; hour &lt;&lt; <span class="org-string">":"</span> &lt;&lt; minute &lt;&lt; <span class="org-string">" "</span> &lt;&lt; ampm &lt;&lt; endl;
    }
};

<span class="org-keyword">class</span> <span class="org-type">MachineTimeImp</span>: <span class="org-keyword">public</span> <span class="org-type">TimeImp</span> {
<span class="org-keyword">public</span>:
    <span class="org-function-name">MachineTimeImp</span>(<span class="org-type">int</span> <span class="org-variable-name">h</span>, <span class="org-type">int</span> <span class="org-variable-name">m</span>): TimeImp(h, m) {}
    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">tell</span>() {
        cout &lt;&lt; <span class="org-string">"Time is "</span> &lt;&lt; hour &lt;&lt; minute &lt;&lt; endl;
    }
};

<span class="org-comment-delimiter">/***** </span><span class="org-comment">Interface *****/</span>

<span class="org-keyword">class</span> <span class="org-type">Time</span> {
<span class="org-keyword">protected</span>:
    <span class="org-type">TimeImp</span>* <span class="org-variable-name">imp</span>;
<span class="org-keyword">public</span>:
    <span class="org-function-name">Time</span>() {}
    <span class="org-keyword">virtual</span> ~<span class="org-function-name">Time</span>() = 0;
    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">tell</span>() {
        imp-&gt;tell();
    }
};
<span class="org-constant">Time</span>::~<span class="org-function-name">Time</span>() {}

<span class="org-keyword">class</span> <span class="org-type">CivilianTime</span>: <span class="org-keyword">public</span> <span class="org-type">Time</span> {
<span class="org-keyword">public</span>:
    <span class="org-function-name">CivilianTime</span>(<span class="org-type">int</span> <span class="org-variable-name">hour</span>, <span class="org-type">int</span> <span class="org-variable-name">minute</span>) {
        imp = <span class="org-keyword">new</span> <span class="org-type">HumanTimeImp</span>(hour, minute);
    }
};

<span class="org-keyword">class</span> <span class="org-type">MilitaryTime</span>: <span class="org-keyword">public</span> <span class="org-type">Time</span> {
<span class="org-keyword">public</span>:
    <span class="org-function-name">MilitaryTime</span>(<span class="org-type">int</span> <span class="org-variable-name">hour</span>, <span class="org-type">int</span> <span class="org-variable-name">minute</span>) {
        imp = <span class="org-keyword">new</span> <span class="org-type">MachineTimeImp</span>(hour, minute);
    }
};

<span class="org-type">int</span> <span class="org-function-name">main</span>() {
    <span class="org-type">Time</span>* <span class="org-variable-name">time1</span> = <span class="org-keyword">new</span> <span class="org-type">CivilianTime</span>(14, 30);
    <span class="org-type">Time</span>* <span class="org-variable-name">time2</span> = <span class="org-keyword">new</span> <span class="org-type">MilitaryTime</span>(14, 30);
    time1-&gt;tell(); <span class="org-comment-delimiter">// </span><span class="org-comment">Time is 2:30 PM</span>
    time2-&gt;tell(); <span class="org-comment-delimiter">// </span><span class="org-comment">Time is 1430</span>
    <span class="org-keyword">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Composite</h3>
<div class="outline-text-3" id="text-3-3">

<div class="figure">
<p><img src="../images/design_pattern/21.svg" alt="21.svg" />
</p>
</div>

<ul class="org-ul">
<li>Compose objects into tree structures, and lets clients <span class="underline">treat individual objects and compositions of objects uniformly</span>.
</li>
<li>例子：文件夹包含若干条目，有些条目本身又是文件夹。
</li>
</ul>
</div>

<div id="outline-container-sec-3-3-1" class="outline-4">
<h4 id="sec-3-3-1"><span class="section-number-4">3.3.1</span> 特点</h4>
<div class="outline-text-4" id="text-3-3-1">
<ul class="org-ul">
<li>Abstract base class defines the behavior to be exercised uniformly across primitive and composite objects.
</li>
<li>Primitive and Composite classes are subclasses of base class.
</li>
<li>Each Composite object "couples" itself to the abstract type as it manages its "children".
</li>
<li>Child management methods <code>addChild()</code> and <code>removeChild()</code> should normally be defined in the Composite class. Unfortunately, the desire to treat Primitive and Composite objects uniformly may require that these methods be promoted to the abstract class. 
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-3-2" class="outline-4">
<h4 id="sec-3-3-2"><span class="section-number-4">3.3.2</span> 关系</h4>
<div class="outline-text-4" id="text-3-3-2">
</div><ol class="org-ol"><li>Chain of Responsibility<br  /><div class="outline-text-5" id="text-3-3-2-1">
<ul class="org-ul">
<li>Composite could use Chain of Responsibility to let components access global properties through their parent.
</li>
</ul>
</div>
</li>
<li>Decorator<br  /><div class="outline-text-5" id="text-3-3-2-2">
<ul class="org-ul">
<li>Composite and Decorator have similar structure diagrams, reflecting the fact that both rely on recursive composition to organize an open-ended number of objects.
</li>
<li>Decorator is designed to add responsibilities to objects without subclassing. Composite's focus is not on embellishment but on representation. These intents are distinct but complementary. Consequently, Composite and Decorator are often used in concert.
</li>
<li>Composite could use Decorator to override global properties on parts of the composition.
</li>
</ul>
</div>
</li>
<li>Flyweight<br  /><div class="outline-text-5" id="text-3-3-2-3">
<ul class="org-ul">
<li>Flyweight is often combined with Composite to implement shared leaf nodes.
</li>
</ul>
</div>
</li>
<li>Iterator<br  /><div class="outline-text-5" id="text-3-3-2-4">
<ul class="org-ul">
<li>Composite can be traversed with Iterator.
</li>
</ul>
</div>
</li>
<li>Mediator<br  /><div class="outline-text-5" id="text-3-3-2-5">
<ul class="org-ul">
<li>Composite can compose a Mediator out of smaller pieces through recursive composition.
</li>
</ul>
</div>
</li>
<li>Observer<br  /><div class="outline-text-5" id="text-3-3-2-6">
<ul class="org-ul">
<li>Composite could use Observer to tie one object structure to another.
</li>
</ul>
</div>
</li>
<li>State<br  /><div class="outline-text-5" id="text-3-3-2-7">
<ul class="org-ul">
<li>Composite could use State to let a component change its behavior as its state changes.
</li>
</ul>
</div>
</li>
<li>Visitor<br  /><div class="outline-text-5" id="text-3-3-2-8">
<ul class="org-ul">
<li>Visitor can apply an operation over a Composite.
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-3-3-3" class="outline-4">
<h4 id="sec-3-3-3"><span class="section-number-4">3.3.3</span> 示例</h4>
<div class="outline-text-4" id="text-3-3-3">
<div class="org-src-container">

<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-type">Descriptor</span> {
<span class="org-keyword">protected</span>:
    <span class="org-type">string</span> <span class="org-variable-name">name</span>;
<span class="org-keyword">public</span>:
    <span class="org-function-name">Descriptor</span>(<span class="org-type">string</span> <span class="org-variable-name">s</span>): name(s) {}
    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">display</span>(<span class="org-type">int</span> <span class="org-variable-name">i</span> = 0) {
        cout &lt;&lt; string(i, <span class="org-string">' '</span>) &lt;&lt; name &lt;&lt; endl;
    };
};

<span class="org-keyword">class</span> <span class="org-type">File</span>: <span class="org-keyword">public</span> <span class="org-type">Descriptor</span> {
<span class="org-keyword">public</span>:
    <span class="org-function-name">File</span>(<span class="org-type">string</span> <span class="org-variable-name">s</span>): Descriptor(s) {}
};

<span class="org-keyword">class</span> <span class="org-type">Directory</span>: <span class="org-keyword">public</span> <span class="org-type">Descriptor</span> {
    <span class="org-type">vector</span>&lt;<span class="org-type">Descriptor</span>*&gt; <span class="org-variable-name">children</span>;
<span class="org-keyword">public</span>:
    <span class="org-function-name">Directory</span>(<span class="org-type">string</span> <span class="org-variable-name">s</span>): Descriptor(s) {}
    <span class="org-type">void</span> <span class="org-function-name">add</span>(<span class="org-type">Descriptor</span>* <span class="org-variable-name">d</span>) {
        children.push_back(d);
    }
    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">display</span>(<span class="org-type">int</span> <span class="org-variable-name">i</span> = 0) {
        <span class="org-constant">Descriptor</span>::display(i);
        <span class="org-keyword">for</span> (<span class="org-keyword">auto</span> <span class="org-type">d</span>: children)
            d-&gt;display(i + 2);
    }
};

<span class="org-type">int</span> <span class="org-function-name">main</span>() {
    <span class="org-type">Directory</span>* <span class="org-variable-name">d1</span> = <span class="org-keyword">new</span> <span class="org-type">Directory</span>(<span class="org-string">"dir1/"</span>);
    <span class="org-type">Directory</span>* <span class="org-variable-name">d2</span> = <span class="org-keyword">new</span> <span class="org-type">Directory</span>(<span class="org-string">"dir2/"</span>);
    <span class="org-type">File</span>* <span class="org-variable-name">f1</span> = <span class="org-keyword">new</span> <span class="org-type">File</span>(<span class="org-string">"file1"</span>);
    <span class="org-type">File</span>* <span class="org-variable-name">f2</span> = <span class="org-keyword">new</span> <span class="org-type">File</span>(<span class="org-string">"file2"</span>);
    <span class="org-type">File</span>* <span class="org-variable-name">f3</span> = <span class="org-keyword">new</span> <span class="org-type">File</span>(<span class="org-string">"file3"</span>);

    d1-&gt;add(f1);
    d1-&gt;add(d2);
    d2-&gt;add(f2);
    d2-&gt;add(f3);

    d1-&gt;display();
    f2-&gt;display();

    <span class="org-keyword">return</span> 0;
}
<span class="org-comment-delimiter">// </span><span class="org-comment">dir1/</span>
<span class="org-comment-delimiter">//   </span><span class="org-comment">file1</span>
<span class="org-comment-delimiter">//   </span><span class="org-comment">dir2/</span>
<span class="org-comment-delimiter">//     </span><span class="org-comment">file2</span>
<span class="org-comment-delimiter">//     </span><span class="org-comment">file3</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">file2</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> Decorator</h3>
<div class="outline-text-3" id="text-3-4">

<div class="figure">
<p><img src="../images/design_pattern/17.svg" alt="17.svg" />
</p>
</div>

<ul class="org-ul">
<li>Attach additional responsibilities to an object dynamically.
</li>
<li>Client-specified embellishment of <span class="underline">a core object by recursively wrapping</span> it.
</li>
<li>Provide a flexible alternative to subclassing for extending functionality.
</li>
</ul>
</div>

<div id="outline-container-sec-3-4-1" class="outline-4">
<h4 id="sec-3-4-1"><span class="section-number-4">3.4.1</span> 问题</h4>
<div class="outline-text-4" id="text-3-4-1">
<p>
Suppose a UI toolkit supporting adding borders and scroll bars to windows. If implemented by inheritance:
</p>


<div class="figure">
<p><img src="../images/design_pattern/18.svg" alt="18.svg" />
</p>
</div>

<p>
To achieve the same flexibility with Decorator pattern:
</p>


<div class="figure">
<p><img src="../images/design_pattern/19.svg" alt="19.svg" />
</p>
</div>

<div class="org-src-container">
<label class="org-src-name">Client has the ability to specify whatever combination of "features" is desired.</label>
<pre class="src src-java">Widget* widget = <span class="org-keyword">new</span> <span class="org-type">BorderDecorator</span>(
  <span class="org-keyword">new</span> <span class="org-type">HorizontalScrollBarDecorator</span>(
    <span class="org-keyword">new</span> <span class="org-type">VerticalScrollBarDecorator</span>(
      <span class="org-keyword">new</span> <span class="org-type">Window</span>(80, 24))));
widget-&gt;draw();
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-4-2" class="outline-4">
<h4 id="sec-3-4-2"><span class="section-number-4">3.4.2</span> 特点</h4>
<div class="outline-text-4" id="text-3-4-2">
<ul class="org-ul">
<li>Encapsulating the original object inside an abstract wrapper interface.
</li>
<li>Both decorator objects and the core object inherit from this abstract interface.
</li>
<li>Each <span class="underline">decorator class always delegate to the Decorator base class</span>.
</li>
<li>The interface uses recursive composition to allow an unlimited number of decorator "layers" to be added to each core object.
</li>
<li>The <span class="underline">interface presented to client must remain constant</span> as successive layers are specified.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-4-3" class="outline-4">
<h4 id="sec-3-4-3"><span class="section-number-4">3.4.3</span> 关系</h4>
<div class="outline-text-4" id="text-3-4-3">
</div><ol class="org-ol"><li>Adapter<br  /><div class="outline-text-5" id="text-3-4-3-1">
<ul class="org-ul">
<li>Adapter provides a different interface to its subject. Proxy provides the same interface. Decorator provides an enhanced interface.
</li>
<li>Adapter changes an object's interface, Decorator enhances an object's responsibilities. Decorator is more transparent to the client.
</li>
<li>Decorator supports recursive composition, which isn't possible with pure Adapters.
</li>
</ul>
</div>
</li>
<li>Chain of Responsibility<br  /><div class="outline-text-5" id="text-3-4-3-2">
<ul class="org-ul">
<li>Composite could use Chain of Responsibility to let components access global properties through their parent. It could also use Decorator to override these properties on parts of the composition.
</li>
</ul>
</div>
</li>
<li>Composite<br  /><div class="outline-text-5" id="text-3-4-3-3">
<ul class="org-ul">
<li>Composite and Decorator have similar structure diagrams. Both rely on recursive composition to organize an open-ended number of objects.
</li>
<li>A Decorator can be viewed as a degenerate Composite with only one component. However, a Decorator adds additional responsibilities, it isn't intended for object aggregation.
</li>
<li>Decorator is designed to add responsibilities to objects without subclassing. Composite's focus is not on embellishment but on representation. Composite and Decorator are often used in concert.
</li>
</ul>
</div>
</li>
<li>Proxy<br  /><div class="outline-text-5" id="text-3-4-3-4">
<ul class="org-ul">
<li>Decorator and Proxy have different purposes but similar structures. Both describe how to provide a level of indirection to another object, and the implementations keep a reference to the object to which they forward requests.
</li>
</ul>
</div>
</li>
<li>Strategy<br  /><div class="outline-text-5" id="text-3-4-3-5">
<ul class="org-ul">
<li>Decorator lets you change the skin of an object. Strategy lets you change the guts.
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-3-4-4" class="outline-4">
<h4 id="sec-3-4-4"><span class="section-number-4">3.4.4</span> 示例</h4>
<div class="outline-text-4" id="text-3-4-4">
<div class="org-src-container">

<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-type">Explosive</span> {
<span class="org-keyword">public</span>:
    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">explode</span>() = 0;
};

<span class="org-comment-delimiter">// </span><span class="org-comment">Core class</span>
<span class="org-keyword">class</span> <span class="org-type">Fireworks</span>: <span class="org-keyword">public</span> <span class="org-type">Explosive</span> {
<span class="org-keyword">public</span>:
    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">explode</span>() {
        cout &lt;&lt; <span class="org-string">"Firework explodes"</span> &lt;&lt; endl;
    }
};

<span class="org-comment-delimiter">// </span><span class="org-comment">Base decorator class:</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">- Sibling of core class</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">- Parent of concrete decorator classes</span>
<span class="org-keyword">class</span> <span class="org-type">Decorator</span>: <span class="org-keyword">public</span> <span class="org-type">Explosive</span> {
    <span class="org-comment-delimiter">// </span><span class="org-comment">Core class pointer</span>
    <span class="org-type">Explosive</span>* <span class="org-variable-name">exp</span>;
<span class="org-keyword">public</span>:
    <span class="org-function-name">Decorator</span>(<span class="org-type">Explosive</span>* <span class="org-variable-name">e</span>): exp(e) {}

    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">explode</span>() {
        <span class="org-comment-delimiter">// </span><span class="org-comment">Delegate to core class</span>
        exp-&gt;explode();
    }
};

<span class="org-keyword">class</span> <span class="org-type">RedLayer</span>: <span class="org-keyword">public</span> <span class="org-type">Decorator</span> {
<span class="org-keyword">public</span>:
    <span class="org-function-name">RedLayer</span>(<span class="org-type">Explosive</span>* <span class="org-variable-name">e</span>): Decorator(e) {}

    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">explode</span>() {
        <span class="org-comment-delimiter">// </span><span class="org-comment">Delegate to base class</span>
        <span class="org-constant">Decorator</span>::explode();
        <span class="org-comment-delimiter">// </span><span class="org-comment">Enhancement</span>
        cout &lt;&lt; <span class="org-string">"Red light glows"</span> &lt;&lt; endl;
    }
};

<span class="org-keyword">class</span> <span class="org-type">YellowLayer</span>: <span class="org-keyword">public</span> <span class="org-type">Decorator</span> {
<span class="org-keyword">public</span>:
    <span class="org-function-name">YellowLayer</span>(<span class="org-type">Explosive</span>* <span class="org-variable-name">e</span>): Decorator(e) {}

    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">explode</span>() {
        <span class="org-constant">Decorator</span>::explode();
        cout &lt;&lt; <span class="org-string">"Yellow light glows"</span> &lt;&lt; endl;
    }
};

<span class="org-type">int</span> <span class="org-function-name">main</span>() {
    <span class="org-comment-delimiter">// </span><span class="org-comment">Compose desired configuration</span>
    <span class="org-type">Explosive</span>* <span class="org-variable-name">e</span> = <span class="org-keyword">new</span> <span class="org-type">RedLayer</span>(<span class="org-keyword">new</span> <span class="org-type">YellowLayer</span>(<span class="org-keyword">new</span> <span class="org-type">RedLayer</span>(<span class="org-keyword">new</span> <span class="org-type">Fireworks</span>())));
    e-&gt;explode();
    <span class="org-comment-delimiter">// </span><span class="org-comment">Firework explodes</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">Red light glows</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">Yellow light glows</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">Red light glows</span>

    <span class="org-keyword">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3-5" class="outline-3">
<h3 id="sec-3-5"><span class="section-number-3">3.5</span> Proxy</h3>
<div class="outline-text-3" id="text-3-5">

<div class="figure">
<p><img src="../images/design_pattern/16.svg" alt="16.svg" />
</p>
</div>

<ul class="org-ul">
<li>方法在使用时需要调整，但直接修改会违反「开闭原则」，通过代理类，调用并扩展原有方法，可对产生的结果进行控制。
</li>
<li>通过代理，使业务模块只关注业务，非业务的逻辑（如权限控制）由代理负责，以完成解耦。
</li>
<li>Add <span class="underline">a wrapper and delegation to protect the real component</span> from undue complexity.
</li>
<li>Use <span class="underline">an extra level of indirection</span> to support distributed, controlled, or intelligent access.
</li>
</ul>
</div>

<div id="outline-container-sec-3-5-1" class="outline-4">
<h4 id="sec-3-5-1"><span class="section-number-4">3.5.1</span> 使用</h4>
<div class="outline-text-4" id="text-3-5-1">
<ul class="org-ul">
<li>As placeholder for "expensive" objects. The real object is only created when a client first requests/accesses it.
</li>
<li>As local representative for a remote object that resides in a different address space. E.g. RPC and CORBA stub.
</li>
<li>As protective layer which controls access to a sensitive object. The proxy checks that the caller has the access permissions required.
</li>
<li>A smart proxy interposes additional actions when an object is accessed:
<ul class="org-ul">
<li>Counting the number of references to the real object and free up when no references exist (aka smart pointer).
</li>
<li>Loading a persistent object into memory when it's first referenced.
</li>
<li>Checking that the real object is locked before it is accessed.
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-5-2" class="outline-4">
<h4 id="sec-3-5-2"><span class="section-number-4">3.5.2</span> 特点</h4>
<div class="outline-text-4" id="text-3-5-2">
<ul class="org-ul">
<li>Proxy holds a pointer to the real class and implements the interface.
</li>
<li>Proxy instantiates the real object the first time the client makes a request of the proxy.
</li>
<li>Proxy forwards all subsequent requests to the encapsulated real object.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-5-3" class="outline-4">
<h4 id="sec-3-5-3"><span class="section-number-4">3.5.3</span> 关系</h4>
<div class="outline-text-4" id="text-3-5-3">
</div><ol class="org-ol"><li>Adapter<br  /><div class="outline-text-5" id="text-3-5-3-1">
<ul class="org-ul">
<li>Adapter provides a different interface to its subject. Proxy provides the same interface. Decorator provides an enhanced interface.
</li>
</ul>
</div>
</li>
<li>Decorator<br  /><div class="outline-text-5" id="text-3-5-3-2">
<ul class="org-ul">
<li>Decorator and Proxy have different purposes but similar structures. Both describe how to provide a level of indirection to another object, and the implementations keep a reference to the object to which they forward requests.
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-3-5-4" class="outline-4">
<h4 id="sec-3-5-4"><span class="section-number-4">3.5.4</span> 示例</h4>
<div class="outline-text-4" id="text-3-5-4">
<div class="org-src-container">

<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Real class</span>
<span class="org-keyword">class</span> <span class="org-type">Data</span> {
    <span class="org-type">int</span> <span class="org-variable-name">data</span>[3];
<span class="org-keyword">public</span>:
    <span class="org-function-name">Data</span>() {
        data[0] = 1;
        data[1] = 3;
        data[2] = 5;
    }
    <span class="org-type">int</span> <span class="org-function-name">read</span>(<span class="org-type">int</span> <span class="org-variable-name">s</span>) {
        <span class="org-keyword">return</span> data[s];
    }
};

<span class="org-comment-delimiter">// </span><span class="org-comment">Proxy class</span>
<span class="org-keyword">class</span> <span class="org-type">DataProxy</span> {
    <span class="org-type">Data</span>* <span class="org-variable-name">real</span>;
    <span class="org-type">int</span> <span class="org-variable-name">clearance</span>;
<span class="org-keyword">public</span>:
    <span class="org-function-name">DataProxy</span>(<span class="org-type">int</span> <span class="org-variable-name">c</span>): clearance(c), real(<span class="org-constant">NULL</span>) {}
    <span class="org-comment-delimiter">// </span><span class="org-comment">Same interface as real class</span>
    <span class="org-type">int</span> <span class="org-function-name">read</span>(<span class="org-type">int</span> <span class="org-variable-name">sector</span>) {
        <span class="org-comment-delimiter">// </span><span class="org-comment">Checking clearance and sector values</span>
        <span class="org-comment-delimiter">// </span><span class="org-comment">Do not call real object's method if illegal</span>
        <span class="org-keyword">if</span> (clearance &lt; 3 || sector &gt; 2)
            <span class="org-keyword">return</span> -1;
        <span class="org-comment-delimiter">// </span><span class="org-comment">Instantiate real object</span>
        <span class="org-keyword">if</span> (<span class="org-negation-char">!</span>real)
            real = <span class="org-keyword">new</span> <span class="org-type">Data</span>;
        <span class="org-comment-delimiter">// </span><span class="org-comment">Delegate call to real object</span>
        <span class="org-keyword">return</span> real-&gt;read(sector);
    }
};

<span class="org-type">DataProxy</span> <span class="org-function-name">dp1</span>(1); cout &lt;&lt; dp1.read(1) &lt;&lt; endl; <span class="org-comment-delimiter">// </span><span class="org-comment">-1, not enough clearance</span>
<span class="org-type">DataProxy</span> <span class="org-function-name">dp2</span>(3); cout &lt;&lt; dp2.read(3) &lt;&lt; endl; <span class="org-comment-delimiter">// </span><span class="org-comment">-1, wrong sector</span>
<span class="org-type">DataProxy</span> <span class="org-function-name">dp3</span>(4); cout &lt;&lt; dp3.read(2) &lt;&lt; endl; <span class="org-comment-delimiter">// </span><span class="org-comment">5</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3-6" class="outline-3">
<h3 id="sec-3-6"><span class="section-number-3">3.6</span> 外观</h3>
<div class="outline-text-3" id="text-3-6">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" class="no-border">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left"><b>应用场景：</b></th>
<th scope="col" class="left">将相关类（和依赖关系）包装在一个类中，降低相关的类之间的依赖关系，解耦合</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><b>例子：</b></td>
<td class="left">IT 公司将主机、存储、OS、J2EE、DB、网络、流程打包成为企业级解决方案</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">Shell 命令通过标准 I/O 接口进行交互，可以组合成脚本实现一个复杂功能</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-sec-3-6-1" class="outline-4">
<h4 id="sec-3-6-1"><span class="section-number-4">3.6.1</span> Java 示例</h4>
<div class="outline-text-4" id="text-3-6-1">
<div class="org-src-container">
<label class="org-src-name">实现类</label>
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">CPU</span> {
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">startup</span>() {
        System.out.println(<span class="org-string">"cpu startup!"</span>);
    }
}
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Memory</span> {
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">startup</span>() {
        System.out.println(<span class="org-string">"memory startup!"</span>);
    }
}
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Disk</span> {
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">startup</span>() {
        System.out.println(<span class="org-string">"disk startup!"</span>);
    }
}
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">外观类</label>
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Computer</span> {
    <span class="org-keyword">private</span> <span class="org-type">CPU</span> <span class="org-variable-name">cpu</span>;
    <span class="org-keyword">private</span> <span class="org-type">Memory</span> <span class="org-variable-name">memory</span>;
    <span class="org-keyword">private</span> <span class="org-type">Disk</span> <span class="org-variable-name">disk</span>;

    <span class="org-keyword">public</span> Computer() {
        cpu = <span class="org-keyword">new</span> <span class="org-type">CPU</span>();
        memory = <span class="org-keyword">new</span> <span class="org-type">Memory</span>();
        disk = <span class="org-keyword">new</span> <span class="org-type">Disk</span>();
    }

    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">startup</span>() {
        System.out.println(<span class="org-string">"start the computer!"</span>);
        cpu.startup();
        memory.startup();
        disk.startup();
        System.out.println(<span class="org-string">"start computer finished!"</span>);
    }
}
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">使用</label>
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">User</span> {
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">main</span>(<span class="org-type">String</span>[] <span class="org-variable-name">args</span>) {
        <span class="org-type">Computer</span> <span class="org-variable-name">computer</span> = <span class="org-keyword">new</span> <span class="org-type">Computer</span>();
        computer.startup();
        computer.shutdown();
    }
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Behavioral</h2>
<div class="outline-text-2" id="text-4">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Chain of responsibility</th>
<th scope="col" class="left">责任链</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">Command</td>
<td class="left">命令</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Iterator</td>
<td class="left">迭代子</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Observer</td>
<td class="left">观察者</td>
</tr>

<tr>
<td class="left">Publish &amp; subscribe</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Strategy</td>
<td class="left">策略</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Template method</td>
<td class="left">模板方法</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Visitor</td>
<td class="left">访问者</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Chain of Responsibility</h3>
<div class="outline-text-3" id="text-4-1">

<div class="figure">
<p><img src="../images/design_pattern/20.svg" alt="20.svg" />
</p>
</div>

<ul class="org-ul">
<li><span class="underline">Chain the receiving objects</span> and pass the request along the chain until an object handles it.
</li>
<li>用于存在不定数量的接收（处理）器、且客户端不知道指定哪一个接收器时。
</li>
<li>可以在不影响客户端的情况下，动态地重新组织和分配责任。
</li>
<li>例子：异常处理机制，向上层传递异常直到被捕获。
</li>
</ul>
</div>

<div id="outline-container-sec-4-1-1" class="outline-4">
<h4 id="sec-4-1-1"><span class="section-number-4">4.1.1</span> 特点</h4>
<div class="outline-text-4" id="text-4-1-1">
<ul class="org-ul">
<li>Processing elements are encapsulated inside a "pipeline" abstraction.
</li>
<li>Each sender keeps a single reference to the head of the chain.
</li>
<li>Each receiver (processing element) keeps a single reference to its immediate successor.
</li>
<li>A "safety net" to "catch" any requests which go unhandled.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-1-2" class="outline-4">
<h4 id="sec-4-1-2"><span class="section-number-4">4.1.2</span> 关系</h4>
<div class="outline-text-4" id="text-4-1-2">
<p>
Chain of Responsibility, Command, Mediator, and Observer, address how to decouple senders and receivers, but with different trade-offs. Chain of Responsibility passes a sender request along a chain of potential receivers.
</p>
</div>

<ol class="org-ol"><li>Command<br  /><div class="outline-text-5" id="text-4-1-2-1">
<ul class="org-ul">
<li>Chain of Responsibility can use Command to represent requests as objects.
</li>
</ul>
</div>
</li>
<li>Composite<br  /><div class="outline-text-5" id="text-4-1-2-2">
<ul class="org-ul">
<li>Chain of Responsibility is often applied in conjunction with Composite. There, a component's parent can act as its successor.
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-4-1-3" class="outline-4">
<h4 id="sec-4-1-3"><span class="section-number-4">4.1.3</span> 示例</h4>
<div class="outline-text-4" id="text-4-1-3">
<div class="org-src-container">

<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-type">Error</span> {
<span class="org-keyword">public</span>:
    <span class="org-type">string</span> <span class="org-variable-name">type</span>, <span class="org-variable-name">message</span>;
    <span class="org-function-name">Error</span>(<span class="org-type">string</span> <span class="org-variable-name">t</span>, <span class="org-type">string</span> <span class="org-variable-name">m</span>): type(t), message(m) {}
};

<span class="org-keyword">class</span> <span class="org-type">Handler</span> {
    <span class="org-type">Handler</span>* <span class="org-variable-name">next</span>;
<span class="org-keyword">public</span>:
    <span class="org-function-name">Handler</span>() {
        next = <span class="org-constant">NULL</span>;
    }
    <span class="org-type">void</span> <span class="org-function-name">chain</span>(<span class="org-type">Handler</span>* <span class="org-variable-name">h</span>) {
        <span class="org-keyword">if</span> (next)
            next-&gt;chain(h);
        <span class="org-keyword">else</span>
            next = h;
    }
    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">handle</span>(<span class="org-type">Error</span>* <span class="org-variable-name">e</span>) {
        <span class="org-keyword">if</span> (next)
            <span class="org-comment-delimiter">// </span><span class="org-comment">Delegate to next handler</span>
            next-&gt;handle(e);
        <span class="org-keyword">else</span>
            cout &lt;&lt; <span class="org-string">"End of chain, error not handled: "</span> &lt;&lt; e-&gt;message &lt;&lt; endl;
    }
};

<span class="org-keyword">class</span> <span class="org-type">NormalHandler</span>: <span class="org-keyword">public</span> <span class="org-type">Handler</span> {
<span class="org-keyword">public</span>:
    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">handle</span>(<span class="org-type">Error</span>* <span class="org-variable-name">e</span>) {
        <span class="org-keyword">if</span> (e-&gt;type.compare(<span class="org-string">"normal"</span>) == 0)
            <span class="org-comment-delimiter">// </span><span class="org-comment">Can handle</span>
            cout &lt;&lt; <span class="org-string">"Normal error handled: "</span> &lt;&lt; e-&gt;message &lt;&lt; endl;
        <span class="org-keyword">else</span>
            <span class="org-comment-delimiter">// </span><span class="org-comment">Cannot handle</span>
            <span class="org-constant">Handler</span>::handle(e);
    }
};

<span class="org-keyword">class</span> <span class="org-type">CriticalHandler</span>: <span class="org-keyword">public</span> <span class="org-type">Handler</span> {
<span class="org-keyword">public</span>:
    <span class="org-keyword">virtual</span> <span class="org-type">void</span> <span class="org-function-name">handle</span>(<span class="org-type">Error</span>* <span class="org-variable-name">e</span>) {
        <span class="org-keyword">if</span> (e-&gt;type.compare(<span class="org-string">"critical"</span>) == 0)
            cout &lt;&lt; <span class="org-string">"Critical error handled: "</span> &lt;&lt; e-&gt;message &lt;&lt; endl;
        <span class="org-keyword">else</span>
            <span class="org-constant">Handler</span>::handle(e);
    }
};

<span class="org-type">int</span> <span class="org-function-name">main</span>() {
    <span class="org-type">Error</span>* <span class="org-variable-name">e1</span> = <span class="org-keyword">new</span> <span class="org-type">Error</span>(<span class="org-string">"normal"</span>, <span class="org-string">"A normal error"</span>);
    <span class="org-type">Error</span>* <span class="org-variable-name">e2</span> = <span class="org-keyword">new</span> <span class="org-type">Error</span>(<span class="org-string">"critical"</span>, <span class="org-string">"A critical error"</span>);
    <span class="org-type">Error</span>* <span class="org-variable-name">e3</span> = <span class="org-keyword">new</span> <span class="org-type">Error</span>(<span class="org-string">"unexpected"</span>, <span class="org-string">"An unexpected error"</span>);

    <span class="org-type">NormalHandler</span> <span class="org-variable-name">h1</span>;
    <span class="org-type">CriticalHandler</span> <span class="org-variable-name">h2</span>;

    h1.handle(e1); <span class="org-comment-delimiter">// </span><span class="org-comment">Normal error handled: A normal error</span>
    h1.handle(e2); <span class="org-comment-delimiter">// </span><span class="org-comment">End of chain, error not handled: A critical error</span>

    <span class="org-comment-delimiter">// </span><span class="org-comment">Extend chain</span>
    h1.chain(&amp;h2);

    h1.handle(e2); <span class="org-comment-delimiter">// </span><span class="org-comment">Critical error handled: A critical error</span>
    h1.handle(e3); <span class="org-comment-delimiter">// </span><span class="org-comment">End of chain, error not handled: An unexpected error</span>

    <span class="org-keyword">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Iterator</h3>
<div class="outline-text-3" id="text-4-2">

<div class="figure">
<p><img src="../images/design_pattern/15.svg" alt="15.svg" />
</p>
</div>

<ul class="org-ul">
<li>Provide a way to access the elements of an aggregate object sequentially without exposing its underlying representation.
</li>
<li>Take the responsibility for access and traversal out of the aggregate object and put it into an Iterator object that defines a standard traversal protocol.
</li>
</ul>
</div>

<div id="outline-container-sec-4-2-1" class="outline-4">
<h4 id="sec-4-2-1"><span class="section-number-4">4.2.1</span> 特点</h4>
<div class="outline-text-4" id="text-4-2-1">
<ul class="org-ul">
<li><code>Collection</code> class has <code>create_iterator()</code> method, which grants the <code>Iterator</code> class privileged access to the elements.
</li>
<li><code>Iterator</code> class encapsulates traversal of <code>Collection</code> class.
</li>
<li>Clients ask <code>Collection</code> object to create an <code>Iterator</code> object.
</li>
<li>Clients use <code>first()</code>, <code>is_done()</code>, <code>next()</code>, and <code>current_item()</code> protocol to access the elements of <code>Collection</code> class.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-2-2" class="outline-4">
<h4 id="sec-4-2-2"><span class="section-number-4">4.2.2</span> 关系</h4>
<div class="outline-text-4" id="text-4-2-2">
</div><ol class="org-ol"><li>Factory Method<br  /><div class="outline-text-5" id="text-4-2-2-1">
<ul class="org-ul">
<li>Polymorphic Iterators rely on Factory Methods to instantiate the appropriate Iterator subclass.
</li>
</ul>
</div>
</li>
<li>Memento<br  /><div class="outline-text-5" id="text-4-2-2-2">
<ul class="org-ul">
<li>Memento is often used in conjunction with Iterator. An Iterator can use a Memento to capture the state of an iteration. The Iterator stores the Memento internally.
</li>
</ul>
</div>
</li>
<li>Visitor<br  /><div class="outline-text-5" id="text-4-2-2-3">
<ul class="org-ul">
<li>The abstract syntax tree of Interpreter is a Composite, therefore Iterator and Visitor are also applicable.
</li>
<li>Iterator can traverse a Composite. Visitor can apply an operation over a Composite.
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-4-2-3" class="outline-4">
<h4 id="sec-4-2-3"><span class="section-number-4">4.2.3</span> 示例</h4>
<div class="outline-text-4" id="text-4-2-3">
<div class="org-src-container">

<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Forward declaration</span>
<span class="org-keyword">class</span> <span class="org-type">Iterator</span>;

<span class="org-keyword">class</span> <span class="org-type">Collection</span> {
    <span class="org-keyword">friend</span> <span class="org-keyword">class</span> <span class="org-type">Iterator</span>;
    <span class="org-type">int</span> <span class="org-variable-name">items</span>[10];
    <span class="org-type">int</span> <span class="org-variable-name">ptr</span>;
<span class="org-keyword">public</span>:
    <span class="org-function-name">Collection</span>() {
        ptr = -1;
    }
    <span class="org-type">void</span> <span class="org-function-name">push</span>(<span class="org-type">int</span> <span class="org-variable-name">n</span>) {
        items[++ptr] = n;
    }
    <span class="org-type">int</span> <span class="org-function-name">pop</span>() {
        <span class="org-keyword">return</span> items[ptr--];
    }
    <span class="org-type">bool</span> <span class="org-function-name">empty</span>() {
        <span class="org-keyword">return</span> ptr == -1;
    }
    <span class="org-comment-delimiter">// </span><span class="org-comment">&#21482;&#33021;&#22768;&#26126;&#26041;&#27861;&#65292;&#22240;&#20026; Iterator &#31867;&#26410;&#23450;&#20041;</span>
    <span class="org-type">Iterator</span>* <span class="org-function-name">iterator</span>() <span class="org-keyword">const</span>;
};

<span class="org-keyword">class</span> <span class="org-type">Iterator</span> {
    <span class="org-keyword">const</span> <span class="org-type">Collection</span>* <span class="org-variable-name">col</span>;
    <span class="org-type">int</span> <span class="org-variable-name">idx</span>;
<span class="org-keyword">public</span>:
    <span class="org-function-name">Iterator</span>(<span class="org-keyword">const</span> <span class="org-type">Collection</span>* <span class="org-variable-name">c</span>): col(c) {}
    <span class="org-type">void</span> <span class="org-function-name">first</span>() {
        idx = 0;
    }
    <span class="org-type">void</span> <span class="org-function-name">last</span>() {
        idx = col-&gt;ptr;
    }
    <span class="org-type">void</span> <span class="org-function-name">next</span>() {
        idx++;
    }
    <span class="org-type">bool</span> <span class="org-function-name">done</span>() {
        <span class="org-keyword">return</span> idx == col-&gt;ptr + 1;
    }
    <span class="org-type">int</span> <span class="org-function-name">current</span>() {
        <span class="org-keyword">return</span> col-&gt;items[idx];
    }
};

<span class="org-type">Iterator</span>* <span class="org-constant">Collection</span>::<span class="org-function-name">iterator</span>() <span class="org-keyword">const</span> {
    <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">Iterator</span>(<span class="org-keyword">this</span>);
}

<span class="org-type">int</span> <span class="org-function-name">main</span>() {
    <span class="org-type">Collection</span> <span class="org-variable-name">col</span>;

    <span class="org-keyword">for</span> (<span class="org-type">int</span> <span class="org-variable-name">i</span> = 0; i &lt; 10; i++)
        col.push(i * 2 + 1);

    <span class="org-type">Iterator</span>* <span class="org-variable-name">itr</span> = col.iterator();
    <span class="org-keyword">for</span> (itr-&gt;first(); <span class="org-negation-char">!</span>itr-&gt;done(); itr-&gt;next())
        cout &lt;&lt; itr-&gt;current() &lt;&lt; endl;

    <span class="org-keyword">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> 命令</h3>
<div class="outline-text-3" id="text-4-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" class="no-border">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left"><b>应用场景：</b></th>
<th scope="col" class="left">把对象的行为封装成相同接口的命令，由命令执行器执行或管理</th>
</tr>

<tr>
<th scope="col" class="left">&#xa0;</th>
<th scope="col" class="left">命令、命令发出者、命令执行者之间相互解耦</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><b>例子：</b></td>
<td class="left">将 daemon 的行为封装成脚本，支持 start/stop/status 等命令，由操作系统接管 daemon 的启动和退出</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1"><span class="section-number-4">4.3.1</span> Java 示例</h4>
<div class="outline-text-4" id="text-4-3-1">
<div class="org-src-container">
<label class="org-src-name">抽象命令</label>
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">interface</span> <span class="org-type">Command</span> {
    <span class="org-type">void</span> <span class="org-function-name">execute</span>();
}
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">具体命令：定义接收者和行为之间的弱耦合，调用接收者</label>
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">ConcreteCommand</span> <span class="org-keyword">implements</span> <span class="org-type">Command</span> {
    <span class="org-keyword">private</span> <span class="org-type">Receiver</span> <span class="org-variable-name">receiver</span> = <span class="org-constant">null</span>;

    <span class="org-keyword">public</span> ConcreteCommand(<span class="org-type">Receiver</span> <span class="org-variable-name">receiver</span>) {
        <span class="org-keyword">this</span>.receiver = receiver;
    }

    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">execute</span>() {
        receiver.action();
    }
}
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">请求者</label>
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Invoker</span> {
    <span class="org-keyword">private</span> <span class="org-type">Command</span> <span class="org-variable-name">command</span> = <span class="org-constant">null</span>;

    <span class="org-keyword">public</span> Invoker(<span class="org-type">Command</span> <span class="org-variable-name">command</span>) {
        <span class="org-keyword">this</span>.command = command;
    }

    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">action</span>() {
        command.execute();
    }
}
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">接收者</label>
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Receiver</span> {
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">action</span>() {
        System.out.println(<span class="org-string">"Execute action."</span>);
    }
}
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">使用</label>
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Client</span> {
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">main</span>(<span class="org-type">String</span>[] <span class="org-variable-name">args</span>) {
        <span class="org-type">Receiver</span> <span class="org-variable-name">receiver</span> = <span class="org-keyword">new</span> <span class="org-type">Receiver</span>();
        <span class="org-type">Command</span> <span class="org-variable-name">command</span> = <span class="org-keyword">new</span> <span class="org-type">ConcreteCommand</span>(receiver);
        <span class="org-type">Invoker</span> <span class="org-variable-name">invoker</span> = <span class="org-keyword">new</span> <span class="org-type">Invoker</span>(command);
        invoker.action();
    }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> 观察者</h3>
<div class="outline-text-3" id="text-4-4">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" class="no-border">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left"><b>应用场景：</b></th>
<th scope="col" class="left">多个观察者同时监听一个主题，主题对象在状态上发生变化时，会通知所有观察者对象</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><b>例子：</b></td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-sec-4-4-1" class="outline-4">
<h4 id="sec-4-4-1"><span class="section-number-4">4.4.1</span> Java 实现</h4>
<div class="outline-text-4" id="text-4-4-1">
<div class="org-src-container">
<label class="org-src-name">观察者接口</label>
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">interface</span> <span class="org-type">Observer</span> {
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">update</span>(<span class="org-type">String</span> <span class="org-variable-name">state</span>);
}
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">观察者实现</label>
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">ConcreteObserver</span> <span class="org-keyword">implements</span> <span class="org-type">Observer</span> {
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">observerState</span>;

    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">update</span>(<span class="org-type">String</span> <span class="org-variable-name">state</span>) {
         observerState = state;
    }
}
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">主题接口</label>
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">interface</span> <span class="org-type">Subject</span> {
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">attach</span>(<span class="org-type">Observer</span> <span class="org-variable-name">observer</span>);
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">detach</span>(<span class="org-type">Observer</span> <span class="org-variable-name">observer</span>);
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">notify</span>();
}
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">主题抽象类</label>
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">abstract</span> <span class="org-keyword">class</span> <span class="org-type">AbstractSubject</span> <span class="org-keyword">implements</span> <span class="org-type">Subject</span> {
    <span class="org-keyword">private</span> <span class="org-type">List</span>&lt;Observer&gt; list = <span class="org-keyword">new</span> <span class="org-type">ArrayList</span>&lt;Observer&gt;();

    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">attach</span>(<span class="org-type">Observer</span> <span class="org-variable-name">observer</span>){
        list.add(observer);
    }

    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">detach</span>(<span class="org-type">Observer</span> <span class="org-variable-name">observer</span>){
        list.remove(observer);
    }

    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">nodify</span>(<span class="org-type">String</span> <span class="org-variable-name">newState</span>){
        <span class="org-keyword">for</span>(<span class="org-type">Observer</span> <span class="org-variable-name">observer</span> : list){
            observer.update(newState);
        }
    }
}
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">主题实现</label>
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">ConcreteSubject</span> {
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">subjectState</span>;

    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">change</span>(<span class="org-type">String</span> <span class="org-variable-name">newState</span>){
        subjectState = newState;
        <span class="org-keyword">this</span>.nodify(subjectState);
    }
}
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">使用</label>
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">Client</span> {
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">main</span>(<span class="org-type">String</span>[] <span class="org-variable-name">args</span>) {
        <span class="org-type">ConcreteSubject</span> <span class="org-variable-name">subject</span> = <span class="org-keyword">new</span> <span class="org-type">ConcreteSubject</span>();
        <span class="org-type">Observer</span> <span class="org-variable-name">observer</span> = <span class="org-keyword">new</span> <span class="org-type">ConcreteObserver</span>();
        subject.attach(observer);
        subject.change(<span class="org-string">"new state"</span>);
    }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-4-5" class="outline-3">
<h3 id="sec-4-5"><span class="section-number-3">4.5</span> 策略</h3>
<div class="outline-text-3" id="text-4-5">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" class="no-border">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left"><b>应用场景：</b></th>
<th scope="col" class="left">一组相关但不同的算法，分别封装起来，使它们可以相互替换</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><b>例子：</b></td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-sec-4-5-1" class="outline-4">
<h4 id="sec-4-5-1"><span class="section-number-4">4.5.1</span> Java 示例</h4>
<div class="outline-text-4" id="text-4-5-1">
<div class="org-src-container">
<label class="org-src-name">抽象策略类</label>
<pre class="src src-java"><span class="org-keyword">interface</span> <span class="org-type">Strategy</span> {
    <span class="org-type">void</span> <span class="org-function-name">execute</span>();
}
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">具体策略类：封装不同的算法或行为</label>
<pre class="src src-java"><span class="org-keyword">class</span> <span class="org-type">FirstStrategy</span> <span class="org-keyword">implements</span> <span class="org-type">Strategy</span> {
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">execute</span>() {
        System.out.println(<span class="org-string">"Called FirstStrategy.execute()"</span>);
    }
}
<span class="org-keyword">class</span> <span class="org-type">SecondStrategy</span> <span class="org-keyword">implements</span> <span class="org-type">Strategy</span> {
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">execute</span>() {
        System.out.println(<span class="org-string">"Called SecondStrategy.execute()"</span>);
    }
}
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">环境类</label>
<pre class="src src-java"><span class="org-keyword">class</span> <span class="org-type">Context</span> {
    <span class="org-type">Strategy</span> <span class="org-variable-name">strategy</span>;

    <span class="org-keyword">public</span> Context(<span class="org-type">Strategy</span> <span class="org-variable-name">strategy</span>) {
        <span class="org-keyword">this</span>.strategy = strategy;
    }

    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">execute</span>() {
        <span class="org-keyword">this</span>.strategy.execute();
    }
}
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">使用</label>
<pre class="src src-java"><span class="org-keyword">class</span> <span class="org-type">StrategyExample</span> {
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">main</span>(<span class="org-type">String</span>[] <span class="org-variable-name">args</span>) {
        <span class="org-type">Context</span> <span class="org-variable-name">context</span>;

        context = <span class="org-keyword">new</span> <span class="org-type">Context</span>(<span class="org-keyword">new</span> <span class="org-type">FirstStrategy</span>());
        context.execute();

        context = <span class="org-keyword">new</span> <span class="org-type">Context</span>(<span class="org-keyword">new</span> <span class="org-type">SecondStrategy</span>());
        context.execute();
    }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-4-6" class="outline-3">
<h3 id="sec-4-6"><span class="section-number-3">4.6</span> 访问者</h3>
<div class="outline-text-3" id="text-4-6">

<div class="figure">
<p><img src="../images/design_pattern/07.png" alt="07.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> 依赖</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> 依赖注入</h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li>Dependency Injection (DI)
</li>
<li>从硬编码的依赖中解耦，在运行、编译时能够修改的设计模式。
</li>
</ul>

<div class="org-src-container">
<label class="org-src-name">示例</label>
<pre class="src src-php"><span class="org-comment-delimiter">// </span><span class="org-comment">Before</span>
<span class="org-keyword">class</span> <span class="org-type">Database</span> {
    <span class="org-keyword">protected</span> $<span class="org-variable-name">adapter</span>;
    <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">__construct</span>() {
        $<span class="org-constant">this</span>-&gt;<span class="org-variable-name">adapter</span> = <span class="org-keyword">new</span> <span class="org-type">MySqlAdapter</span>; <span class="org-comment-delimiter">// </span><span class="org-comment">&#32806;&#21512;&#65292;&#27979;&#35797;&#22256;&#38590;</span>
    }
}
<span class="org-comment-delimiter">// </span><span class="org-comment">After</span>
<span class="org-keyword">class</span> <span class="org-type">Database</span> {
    <span class="org-keyword">protected</span> $<span class="org-variable-name">adapter</span>;
    <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">__construct</span>(<span class="org-type">MySqlAdapter</span> $<span class="org-variable-name">adapter</span>) {
        $<span class="org-constant">this</span>-&gt;<span class="org-variable-name">adapter</span> = $<span class="org-variable-name">adapter</span>; <span class="org-comment-delimiter">// </span><span class="org-comment">&#36890;&#36807;&#20381;&#36182;&#27880;&#20837;&#35299;&#32806;</span>
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> 依赖反转</h3>
<div class="outline-text-3" id="text-5-2">
<ul class="org-ul">
<li>Inversion of Control (IoC)
</li>
<li>对接口编程，依赖于抽象而不是具体，即依赖于约定、接口、抽象类，而不是具体实现。
</li>
</ul>

<div class="org-src-container">
<label class="org-src-name">示例</label>
<pre class="src src-php"><span class="org-comment-delimiter">// </span><span class="org-comment">Before</span>
<span class="org-keyword">class</span> <span class="org-type">Database</span> {
    <span class="org-keyword">protected</span> $<span class="org-variable-name">adapter</span>;
    <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">__construct</span>() {
        $<span class="org-constant">this</span>-&gt;<span class="org-variable-name">adapter</span> = <span class="org-keyword">new</span> <span class="org-type">MySqlAdapter</span>; <span class="org-comment-delimiter">// </span><span class="org-comment">&#32806;&#21512;&#65292;&#27979;&#35797;&#22256;&#38590;</span>
    }
}
<span class="org-comment-delimiter">// </span><span class="org-comment">After</span>
<span class="org-keyword">class</span> <span class="org-type">Database</span> {
    <span class="org-keyword">protected</span> $<span class="org-variable-name">adapter</span>;
    <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">__construct</span>(<span class="org-type">AdapterInterface</span> $<span class="org-variable-name">adapter</span>) { <span class="org-comment-delimiter">// </span><span class="org-comment">&#20381;&#36182;&#20110;&#25509;&#21475;</span>
        $<span class="org-constant">this</span>-&gt;<span class="org-variable-name">adapter</span> = $<span class="org-variable-name">adapter</span>;
    }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Quote</h2>
<div class="outline-text-2" id="text-6">
<div class="org-quote-container">
<blockquote>
<p>
设计模式就三个准则：1）中意于组合而不是继承，2）依赖于接口而不是实现，3）高内聚，低耦合。<a href="http://coolshell.cn/articles/8745.html">Source</a>
</p>
</blockquote>
</div>

<div class="org-quote-container">
<blockquote>
<p>
桥接（Bridge）和策略（Strategy）模式对应 OO 设计模式里的「Favor Composition Over Inheritance」，实现了接口与实现分离的。……把程序分为前端和后端，通过 socket 专用应用协议进行通讯，前端实现策略，后端实现机制。……makefile 把编译器和源代码的解耦……大量的编程框架都多少采用这样的思想，可以像更换汽车零件一样方便地更换具体实现。<a href="http://coolshell.cn/articles/8961.html">Source</a>
</p>
</blockquote>
</div>

<div class="org-quote-container">
<blockquote>
<p>
开发软件采用 top-down 或 bottom-up 的模式，都有优缺点。顶层一般是应用逻辑层，底层一般是原语层（技术沉淀层）。自顶向下的开发，可能会发现底层被很多业务逻辑所侵入，如果自底向上的开发，又可能会发现下层的基础工作有很多用不上。最好的方式是同时进行，在开发中不断的重构，边开发，边理解，边沉淀。……需要胶合层，来胶合业务层和技术层。……策略（业务逻辑）和机制（基础技术或原语）的分离。……OO 用抽象接口来做分离，……但 OO 鼓励了「厚重地胶合和复杂层次」，反而增加了程序的复杂度。而 Unix 采用的是薄的胶合层，薄地相当的优雅。<a href="http://coolshell.cn/articles/8961.html">Source</a>
</p>
</blockquote>
</div>
</div>
</div>
<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> 链接</h2>
<div class="outline-text-2" id="text-7">
<ol class="org-ol">
<li><a href="https://sourcemaking.com/design_patterns">Design Patterns</a>
</li>
</ol>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2017-06-05 Mon 15:21</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.5h)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
