---
title: "PHP Objects, Patterns and Practice"
---
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>PHP Objects, Patterns and Practice</title>
<!-- 2017-09-16 Sat 19:54 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../../styles/readtheorg/css/font.css"/>
<link rel="stylesheet" type="text/css" href="../../styles/readtheorg/css/readtheorg.css"/>
<link rel="stylesheet" type="text/css" href="../../styles/readtheorg/css/htmlize.css"/>
<script type="text/javascript" src="../../styles/readtheorg/js/jquery.min.js"></script>
<script type="text/javascript" src="../../styles/readtheorg/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">PHP Objects, Patterns and Practice</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. PHP and Objects</a>
<ul>
<li><a href="#sec-1-1">1.1. The Accidental Success of PHP Objects</a></li>
<li><a href="#sec-1-2">1.2. Advocacy and Agnosticism: The Object Debate</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Object Basics</a>
<ul>
<li><a href="#sec-2-1">2.1. Arguments and Types</a>
<ul>
<li><a href="#sec-2-1-1">2.1.1. Primitive Types</a></li>
<li><a href="#sec-2-1-2">2.1.2. Object Types</a></li>
</ul>
</li>
<li><a href="#sec-2-2">2.2. Inheritance</a>
<ul>
<li><a href="#sec-2-2-1">2.2.1. The Inheritance Problem</a></li>
<li><a href="#sec-2-2-2">2.2.2. Working with Inheritance</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3">3. Advanced Features</a>
<ul>
<li><a href="#sec-3-1">3.1. Static Methods and Properties</a></li>
<li><a href="#sec-3-2">3.2. Traits</a>
<ul>
<li><a href="#sec-3-2-1">3.2.1. Defining and Using a Trait</a></li>
</ul>
</li>
<li><a href="#sec-3-3">3.3. Late Static Bindings</a></li>
<li><a href="#sec-3-4">3.4. Handling Errors</a></li>
<li><a href="#sec-3-5">3.5. Working with Interceptors</a></li>
<li><a href="#sec-3-6">3.6. Callbacks, Anonymous Functions, and Closures</a></li>
</ul>
</li>
<li><a href="#sec-4">4. Object Tools</a>
<ul>
<li><a href="#sec-4-1">4.1. PHP and Packages</a>
<ul>
<li><a href="#sec-4-1-1">4.1.1. PHP Packages and Namespaces</a></li>
<li><a href="#sec-4-1-2">4.1.2. Include Paths</a></li>
<li><a href="#sec-4-1-3">4.1.3. Autoload</a></li>
</ul>
</li>
<li><a href="#sec-4-2">4.2. The Class and Object Functions</a></li>
</ul>
</li>
<li><a href="#sec-5">5. Objects and Design</a>
<ul>
<li><a href="#sec-5-1">5.1. Object-Oriented and Procedural Programming</a>
<ul>
<li><a href="#sec-5-1-1">5.1.1. Responsibility</a></li>
<li><a href="#sec-5-1-2">5.1.2. Cohesion</a></li>
<li><a href="#sec-5-1-3">5.1.3. Coupling</a></li>
<li><a href="#sec-5-1-4">5.1.4. Orthogonality</a></li>
</ul>
</li>
<li><a href="#sec-5-2">5.2. Choosing Your Classes</a></li>
<li><a href="#sec-5-3">5.3. Polymorphism</a></li>
<li><a href="#sec-5-4">5.4. Encapsulation</a></li>
<li><a href="#sec-5-5">5.5. Forget How to Do It</a></li>
<li><a href="#sec-5-6">5.6. Four Signposts</a>
<ul>
<li><a href="#sec-5-6-1">5.6.1. Code Duplication</a></li>
<li><a href="#sec-5-6-2">5.6.2. The Class Who Knew Too Much</a></li>
</ul>
</li>
<li><a href="#sec-5-7">5.7. The UML [Skipped]</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> PHP and Objects</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> The Accidental Success of PHP Objects</h3>
<div class="outline-text-3" id="text-1-1">
<p>
OO design often uses a method declaration as a kind of contract. The method demands certain inputs and, reciprocally, promises to give a particular type of data back.
</p>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Advocacy and Agnosticism: The Object Debate</h3>
<div class="outline-text-3" id="text-1-2">
<p>
One can create perfectly acceptable working systems using functions and global code. "There's more than one way to do it." This is especially true of smaller scripts, where quickly getting a working example up and running is more important than building a structure that will scale well into a larger system (scratch projects of this sort are often known as "spikes"). The trick is to know when the quick proof of concept is becoming the root of a larger development, and to call a halt before lasting design decisions are made by the sheer weight of code.
</p>

<p>
It is becoming increasingly hard to work as a PHP programmer without using and understanding PHP's support for objects, not least because the third party libraries used in projects will themselves likely be object-oriented.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Object Basics</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Arguments and Types</h3>
<div class="outline-text-3" id="text-2-1">
</div><div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1"><span class="section-number-4">2.1.1</span> Primitive Types</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
It is better to provide a clear and strict interface for a method or function than it is to offer a fuzzily forgiving one. Fuzzy and forgiving functions and methods can promote confusion and thereby breed bugs.
</p>

<p>
Type matters. The fact that PHP is loosely typed makes it all the more important. One cannot rely on a compiler to prevent type-related bugs. Consider the potential impact of unexpected types when they find their way into the arguments. Don't trust client coders to read your thoughts, and always consider how the methods will deal with incoming garbage.
</p>
</div>
</div>
<div id="outline-container-sec-2-1-2" class="outline-4">
<h4 id="sec-2-1-2"><span class="section-number-4">2.1.2</span> Object Types</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
When you define a class, you also define a type, but a type can describe an entire family of classes.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Inheritance</h3>
<div class="outline-text-3" id="text-2-2">
</div><div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1"><span class="section-number-4">2.2.1</span> The Inheritance Problem</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
A complex function/class that needs to differentiate various conditions can be separated into different functions/classes. Then the complexity issue is addressed at a cost, which is duplication. By making child classes inherit from common parent class, duplication can be minimized.
</p>
</div>
</div>
<div id="outline-container-sec-2-2-2" class="outline-4">
<h4 id="sec-2-2-2"><span class="section-number-4">2.2.2</span> Working with Inheritance</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
Super class's implementation of a method might seem redundant if it is overridden by all children. Nevertheless, it provides basic functionality that new child classes might use. Its presence also provides a guarantee to client code that all children objects will provide this method. It is possible to make this promise in a base class without providing any implementation at all, by using abstract method or interface.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Advanced Features</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Static Methods and Properties</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Methods like this act as "factories" in that they take raw materials (row data or configuration information) and use them to produce objects. The term <b>factory</b> is applied to code designed to generate object instances.
</p>

<p>
It is not good practice for a parent class to have intimate knowledge of its children.  Problems of this kind - where to acquire key objects and values and how much classes should know about one another - are very common in object-oriented programming.
</p>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Traits</h3>
<div class="outline-text-3" id="text-3-2">
</div><div id="outline-container-sec-3-2-1" class="outline-4">
<h4 id="sec-3-2-1"><span class="section-number-4">3.2.1</span> Defining and Using a Trait</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
One of the core object-oriented design goals is the removal of duplication. One solution to this kind of duplication is to factor it out into a reusable strategy class. Traits provide another approach - less elegant, perhaps, but certainly effective.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Late Static Bindings</h3>
<div class="outline-text-3" id="text-3-3">
<p>
A static method can be used as factory, a way of generating instances of the containing class. Why use a static factory method when a constructor performs the work of creating an object already? Because of a pattern called Identity Map. An Identity Map component generates and manages a new object only if an object with the same distinguishing characteristics is not already under management. If the target object already exists, it is returned. A factory method like <code>create()</code> would make a good client for a component of this sort.
</p>
</div>
</div>

<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> Handling Errors</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Testing for error conditions is relatively trivial, but it must be decided how to respond to them should they arise. Methods that detect errors usually do not have the information to decide how to handle them. Some options:
</p>

<ol class="org-ol">
<li>End execution.
<ul class="org-ul">
<li>Have to take responsibility for bringing an entire script crashing down.
</li>
</ul>
</li>
<li>Return an error flag, e.g. a boolean or an integer value of 0 or -1.
<ul class="org-ul">
<li>Return value is polluted.
</li>
<li>Have to rely on the client code to test for the return type. There is no guarantee that the client will be any better equipped to decide how to handle the error.
</li>
</ul>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-3-5" class="outline-3">
<h3 id="sec-3-5"><span class="section-number-3">3.5</span> Working with Interceptors</h3>
<div class="outline-text-3" id="text-3-5">
<p>
<code>__call()</code> method can be useful for delegation - the mechanism by which one object passes method invocations on to a second. With inheritance the relationship between child and parent is fixed, the ability to switch the receiving object at runtime means that <span class="underline">delegation can be more flexible than inheritance</span>.
</p>

<div class="org-src-container">

<pre class="src src-php"><span class="org-keyword">class</span> <span class="org-type">Person</span> {
    <span class="org-keyword">private</span> $<span class="org-variable-name">writer</span>;
    <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">__construct</span>(<span class="org-type">PersonWriter</span> $<span class="org-variable-name">writer</span>) {
        $<span class="org-constant">this</span>-&gt;<span class="org-variable-name">writer</span> = $<span class="org-variable-name">writer</span>;
    }
    <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">__call</span>(<span class="org-type">string</span> $<span class="org-variable-name">method</span>, <span class="org-type">array</span> $<span class="org-variable-name">args</span>) {
        <span class="org-keyword">if</span> (<span class="org-function-name">method_exists</span>($<span class="org-constant">this</span>-&gt;<span class="org-variable-name">writer</span>, $<span class="org-variable-name">method</span>)) {
            $<span class="org-constant">this</span>-&gt;<span class="org-variable-name">writer</span>-&gt;<span class="org-function-name">$method</span>($<span class="org-constant">this</span>); <span class="org-comment-delimiter">// </span><span class="org-comment">Delegate to writer</span>
        }
    }
    <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">getName</span>(): <span class="org-warning">string</span> {
        <span class="org-keyword">return</span> <span class="org-string">'Foo Bar'</span>;
    }
}

<span class="org-keyword">class</span> <span class="org-type">PersonWriter</span> {
    <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">writeName</span>(<span class="org-type">Person</span> $<span class="org-variable-name">person</span>) {
        <span class="org-keyword">echo</span> <span class="org-string">'Name: '</span> . $<span class="org-variable-name">person</span>-&gt;<span class="org-function-name">getName</span>() . <span class="org-string">"\n"</span>;
    }
}

$<span class="org-variable-name">writer</span> = <span class="org-keyword">new</span> <span class="org-type">PersonWriter</span>();
$<span class="org-variable-name">person</span> = <span class="org-keyword">new</span> <span class="org-type">Person</span>($<span class="org-variable-name">writer</span>);
$<span class="org-variable-name">person</span>-&gt;<span class="org-function-name">writeName</span>();
</pre>
</div>

<p>
Although automated delegation can save a lot of legwork, there can be a cost in clarity. Rely too much on delegation, you present the world with a dynamic interface that resists reflection. The logic that governs the interaction between a delegating class and its target can be obscure - buried in methods like <code>__call()</code> rather than signaled up front by inheritance relationships or method type hints.
</p>

<p>
<code>__get()</code> and <code>__set()</code> interceptor methods can also be used to manage composite properties.
</p>

<div class="org-src-container">

<pre class="src src-php"><span class="org-preprocessor">&lt;?php</span>
<span class="org-keyword">class</span> <span class="org-type">Person</span> {
    <span class="org-keyword">private</span> $<span class="org-variable-name">firstName</span>;
    <span class="org-keyword">private</span> $<span class="org-variable-name">lastName</span>;
    <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">__construct</span>(<span class="org-type">string</span> $<span class="org-variable-name">maybeFirst</span>, <span class="org-type">string</span> $<span class="org-variable-name">maybeLast</span> = <span class="org-constant">null</span>) {
        <span class="org-keyword">if</span> ($<span class="org-variable-name">maybeLast</span> === <span class="org-constant">null</span>) {
            $<span class="org-constant">this</span>-<span class="org-constant">&gt;</span><span class="org-variable-name">fullName</span> = $<span class="org-variable-name">maybeFirst</span>;
        } <span class="org-keyword">else</span> {
            $<span class="org-constant">this</span>-&gt;<span class="org-variable-name">firstName</span> = $<span class="org-variable-name">maybeFirst</span>;
            $<span class="org-constant">this</span>-&gt;<span class="org-variable-name">lastName</span> = $<span class="org-variable-name">maybeLast</span>;
        }
    }
    <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">__set</span>(<span class="org-type">string</span> $<span class="org-variable-name">property</span>, <span class="org-type">string</span> $<span class="org-variable-name">value</span>) {
        <span class="org-keyword">if</span> ($<span class="org-variable-name">property</span> === <span class="org-string">'fullName'</span>) {
            $<span class="org-variable-name">name</span> = <span class="org-function-name">explode</span>(<span class="org-string">' '</span>, $<span class="org-variable-name">value</span>);
            <span class="org-keyword">if</span> (<span class="org-function-name">count</span>($<span class="org-variable-name">name</span>) &gt; <span class="org-default">1</span>) {
                $<span class="org-constant">this</span>-&gt;<span class="org-variable-name">firstName</span> = <span class="org-function-name">array_shift</span>($<span class="org-variable-name">name</span>);
                $<span class="org-constant">this</span>-&gt;<span class="org-variable-name">lastName</span> = <span class="org-function-name">implode</span>(<span class="org-string">' '</span>, $<span class="org-variable-name">name</span>);
            } <span class="org-keyword">else</span> {
                <span class="org-keyword">throw</span> <span class="org-keyword">new</span> <span class="org-type">Exception</span>(<span class="org-string">'Wrong name:'</span> . $<span class="org-variable-name">value</span>);   
            }
        }
    }
    <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">__get</span>(<span class="org-type">string</span> $<span class="org-variable-name">property</span>) {
        <span class="org-keyword">if</span> ($<span class="org-variable-name">property</span> === <span class="org-string">'fullName'</span>) {
            <span class="org-keyword">return</span> $<span class="org-constant">this</span>-&gt;<span class="org-variable-name">firstName</span> . <span class="org-string">' '</span> . $<span class="org-constant">this</span>-&gt;<span class="org-variable-name">lastName</span>;
        }
    }
}

$<span class="org-variable-name">a</span> = <span class="org-keyword">new</span> <span class="org-type">Person</span>(<span class="org-string">'Foo'</span>, <span class="org-string">'Bar'</span>);
<span class="org-keyword">echo</span> $<span class="org-variable-name">a</span>-&gt;<span class="org-variable-name">fullName</span>;
$<span class="org-variable-name">b</span> = <span class="org-keyword">new</span> <span class="org-type">Person</span>(<span class="org-string">'Foo Bar'</span>);
<span class="org-keyword">echo</span> $<span class="org-variable-name">b</span>-&gt;<span class="org-variable-name">fullName</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-6" class="outline-3">
<h3 id="sec-3-6"><span class="section-number-3">3.6</span> Callbacks, Anonymous Functions, and Closures</h3>
<div class="outline-text-3" id="text-3-6">
<p>
Adding many incidental tasks to a method will overwhelm its core responsibility. Callbacks allow plugging functionality into a component at runtime that is not directly related to that component's core task. By making a component callback aware, client code will have the power to extend core code in contexts you don't yet know about.
</p>

<div class="org-src-container">

<pre class="src src-php"><span class="org-keyword">class</span> <span class="org-type">Item</span> {}

<span class="org-keyword">class</span> <span class="org-type">Processor</span> {
    <span class="org-keyword">private</span> $<span class="org-variable-name">callbacks</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">Register callbacks</span>
    <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">registerCallback</span>(<span class="org-type">callable</span> $<span class="org-variable-name">callback</span>) {
        <span class="org-keyword">if</span> (!<span class="org-function-name">is_callable</span>($<span class="org-variable-name">callback</span>)) {
            <span class="org-keyword">throw</span> <span class="org-keyword">new</span> <span class="org-type">Exception</span>(<span class="org-string">'Callback is not callable'</span>);
        }
        $<span class="org-constant">this</span>-&gt;<span class="org-variable-name">callbacks</span>[] = $<span class="org-variable-name">callback</span>;
    }
    <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">process</span>(<span class="org-type">Item</span> $<span class="org-variable-name">item</span>) {
        <span class="org-keyword">echo</span> <span class="org-string">'Processing ...'</span>;
        <span class="org-comment-delimiter">// </span><span class="org-comment">Invoke callbacks</span>
        <span class="org-keyword">foreach</span> ($<span class="org-constant">this</span>-&gt;<span class="org-variable-name">callbacks</span> <span class="org-keyword">as</span> <span class="org-function-name">$callback</span>) {
            <span class="org-function-name">call_user_func</span>($<span class="org-variable-name">callback</span>, $<span class="org-variable-name">item</span>);
        }
    }
}

<span class="org-comment-delimiter">// </span><span class="org-comment">Anonymous function</span>
$<span class="org-variable-name">callback</span> = <span class="org-keyword">function</span>(<span class="org-type">Item</span> $<span class="org-variable-name">item</span>) {
    <span class="org-keyword">echo</span> <span class="org-string">'Additional step ...'</span>;
};

$<span class="org-variable-name">processor</span> = <span class="org-keyword">new</span> <span class="org-type">Processor</span>();
$<span class="org-variable-name">processor</span>-&gt;<span class="org-function-name">registerCallback</span>($<span class="org-variable-name">callback</span>);
$<span class="org-variable-name">processor</span>-&gt;<span class="org-function-name">process</span>(<span class="org-keyword">new</span> <span class="org-type">Item</span>());
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Object Tools</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> PHP and Packages</h3>
<div class="outline-text-3" id="text-4-1">
</div><div id="outline-container-sec-4-1-1" class="outline-4">
<h4 id="sec-4-1-1"><span class="section-number-4">4.1.1</span> PHP Packages and Namespaces</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
Until PHP 5.3, developers were forced to name their files in a global context.
</p>

<div class="org-src-container">
<label class="org-src-name">The most damaging problem was the possibility of naming collisions.</label>
<pre class="src src-php"><span class="org-comment-delimiter">// </span><span class="org-comment">Foo.php</span>
<span class="org-keyword">class</span> <span class="org-type">Dummy</span> {}
<span class="org-comment-delimiter">// </span><span class="org-comment">Bar.php</span>
<span class="org-keyword">include</span> <span class="org-string">'Foo.php'</span>;
<span class="org-keyword">class</span> <span class="org-type">Dummy</span> {} <span class="org-comment-delimiter">// </span><span class="org-comment">Fatal error:  Cannot declare class Dummy ...</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">A conventional workaround was to prepend package names to class names.</label>
<pre class="src src-php"><span class="org-comment-delimiter">// </span><span class="org-comment">Foo.php</span>
<span class="org-keyword">class</span> <span class="org-type">Foo_Dummy</span> {}
<span class="org-comment-delimiter">// </span><span class="org-comment">Bar.php</span>
<span class="org-keyword">include</span> <span class="org-string">'Foo.php'</span>;
<span class="org-keyword">class</span> <span class="org-type">Bar_Dummy</span> {}
</pre>
</div>

<p>
However, as class names grew longer and longer, it resulted in issues with code readability.
</p>

<hr  />

<p>
A domain name is unique to its owner, this is a trick that Java developers typically use for their package names. They invert domain names so that they run from the most generic to the most specific.
</p>
</div>
</div>

<div id="outline-container-sec-4-1-2" class="outline-4">
<h4 id="sec-4-1-2"><span class="section-number-4">4.1.2</span> Include Paths</h4>
<div class="outline-text-4" id="text-4-1-2">
<div class="org-src-container">

<pre class="src src-php"><span class="org-keyword">require_once</span>(<span class="org-constant">__DIR__</span> . <span class="org-string">'/../useful/Outputter.php'</span>);
</pre>
</div>

<p>
The relationship between files is hardcoded. There must always be a <code>useful</code> directory alongside the calling class's containing directory.
</p>

<div class="org-src-container">

<pre class="src src-php"><span class="org-keyword">require_once</span>(<span class="org-string">'../../projectlib/business/User.php'</span>);
</pre>
</div>

<p>
The path is not relative to the file that contains this <code>require_once</code> statement, but to a configured calling context.
</p>

<div class="org-src-container">

<pre class="src src-php"><span class="org-keyword">require_once</span>(<span class="org-string">'/home/john/projectlib/business/User.php'</span>);
</pre>
</div>

<p>
Freeze the library file into a particular context. It will work for a single instance, but it makes libraries hard to relocate and impractical to share among projects. To install the project on a new server, all <code>require</code> statements will need changing to account for a new file path.
</p>

<p>
If must manually include files, the neatest approach is to decouple the invoking code from the library <code>business/User.php</code>.
</p>

<div class="org-src-container">
<label class="org-src-name">This can be achieved by adding the directory to <code>include_path</code>.</label>
<pre class="src src-sh">include_path = <span class="org-string">".:/usr/local/lib/php-libraries"</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">Or with Apache, set <code>include_path</code> in <code>httpd.conf</code> or per-directory configuration file <code>.htaccess</code>.</label>
<pre class="src src-sh">php_value include_path value .:/usr/local/lib/php-libraries
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-4-1-3" class="outline-4">
<h4 id="sec-4-1-3"><span class="section-number-4">4.1.3</span> Autoload</h4>
<div class="outline-text-4" id="text-4-1-3">
<p>
Although it's neat to use <code>require_once</code> in conjunction with <code>include_path</code>, many developers are doing away with require statements altogether at a high level and relying instead on autoload.
</p>

<p>
To use autoload, classes should be organized so that each sits in its own file. And each class file should bear a fixed relationship to the name of the class it contains.
</p>

<hr  />

<p>
<code>spl_autoload_register()</code> stacks the autoload functions. When PHP encounters an unknown class, it will invoke the autoload functions in turn, stopping when instantiation is possible, or when the all options have been exhausted. There is obviously an overhead to this kind of stacking. It is still supported because components in large systems and in third-party libraries may need to register their own autoload mechanisms. Stacking allows multiple parts of a system to register autoload strategies independently, without overwriting one another.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> The Class and Object Functions</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<label class="org-src-name">PHP allows you to use strings to refer to classes dynamically:</label>
<pre class="src src-php"><span class="org-keyword">class</span> <span class="org-type">Foo</span> {}
$<span class="org-variable-name">class</span> = <span class="org-string">'Foo'</span>;
$<span class="org-variable-name">foo</span> = <span class="org-keyword">new</span> $<span class="org-type">class</span>();
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Objects and Design</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Object-Oriented and Procedural Programming</h3>
<div class="outline-text-3" id="text-5-1">
<p>
One core difference between object-oriented and procedural code can be found in the way that responsibility is distributed.
</p>

<p>
In procedure programming, the controlling code tends to take responsibility for handling differing conditions. This top-down control can result in the development of duplications and dependencies across a project. Object-oriented code tries to minimize these dependencies by <span class="underline">moving responsibility for handling tasks away from client code and toward the objects</span>.
</p>
</div>

<div id="outline-container-sec-5-1-1" class="outline-4">
<h4 id="sec-5-1-1"><span class="section-number-4">5.1.1</span> Responsibility</h4>
<div class="outline-text-4" id="text-5-1-1">
<div class="org-src-container">
<label class="org-src-name">Placing a static method for generating child objects in the parent class.</label>
<pre class="src src-php"><span class="org-keyword">abstract</span> <span class="org-keyword">class</span> <span class="org-type">ParamHandler</span> {
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-keyword">function</span> <span class="org-function-name">getInstance</span>(<span class="org-type">string</span> $<span class="org-variable-name">filename</span>) {
        <span class="org-keyword">if</span> (<span class="org-function-name">preg_match</span>(<span class="org-string">"/\.xml$/i"</span>, $<span class="org-variable-name">filename</span>)) {
            <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">XmlParamHandler</span>($<span class="org-variable-name">filename</span>);
        }
        <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">TextParamHandler</span>($<span class="org-variable-name">filename</span>);
    }
    <span class="org-keyword">abstract</span> <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">write</span>();
    <span class="org-keyword">abstract</span> <span class="org-keyword">public</span> <span class="org-keyword">function</span> <span class="org-function-name">read</span>();
}
<span class="org-keyword">class</span> <span class="org-type">TextParamHandler</span> <span class="org-keyword">extends</span> <span class="org-type">ParamHandler</span> {...}
<span class="org-keyword">class</span> <span class="org-type">XmlParamHandler</span> <span class="org-keyword">extends</span> <span class="org-type">ParamHandler</span> {...}
</pre>
</div>

<p>
The choice about file format is made in the static method, which tests the file extension only once. The client code takes no responsibility for implementation. It uses the provided object with no knowledge of, or interest in, the particular subclass it belongs to. Because responsibility for implementation lies with the objects and not with the client code, it would be easy to switch in support for new formats transparently.
</p>

<p>
This pattern is convenient but has its consequences. To handle another format, being the maintainer of <code>ParamHandler</code>, you can amend the <code>getInstance()</code> method. But being a client coder, you face the prospect of having to reapply the patch every time the package is reinstalled.
</p>
</div>
</div>
<div id="outline-container-sec-5-1-2" class="outline-4">
<h4 id="sec-5-1-2"><span class="section-number-4">5.1.2</span> Cohesion</h4>
<div class="outline-text-4" id="text-5-1-2">
<p>
Cohesion is the extent to which <span class="underline">proximate procedures are related to one another</span>. Ideally, components should be created to share a clear responsibility. If related routines are spread widely, it will be harder to maintain as you have to hunt around to make changes.
</p>
</div>
</div>
<div id="outline-container-sec-5-1-3" class="outline-4">
<h4 id="sec-5-1-3"><span class="section-number-4">5.1.3</span> Coupling</h4>
<div class="outline-text-4" id="text-5-1-3">
<p>
Tight coupling occurs when discrete parts of a system's code are tightly bound up with one another so that a <span class="underline">change in one part necessitates changes in the others</span>.
</p>
</div>
</div>
<div id="outline-container-sec-5-1-4" class="outline-4">
<h4 id="sec-5-1-4"><span class="section-number-4">5.1.4</span> Orthogonality</h4>
<div class="outline-text-4" id="text-5-1-4">
<p>
The combination of components with tightly defined responsibilities that are also independent from the wider system is sometimes referred to as orthogonality. Orthogonality promotes reuse in that components can be plugged into new systems without needing any special configuration. Such components will have clear inputs and outputs, independent of any wider context.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Choosing Your Classes</h3>
<div class="outline-text-3" id="text-5-2">
<p>
It can seem straightforward when you are modeling the real world. This is not a bad starting point, but it does have its dangers. You may find it bloating as ongoing development and requirement changes call for it to do more and more things.
</p>

<div class="org-quote-container">
<blockquote>
<p>
A <code>ShopProduct</code> class manages product data. It may provide a mechanism for outputting summary information for invoices and delivery notes with a <code>write()</code> method. But when the client asks for product summaries in different formats, there are 2 options: create <code>writeXML()</code> and <code>writeHTML()</code> methods in addition, or add conditional code to <code>write()</code> to output different formats, according to an option flag. Either way, the problem here is that the <code>ShopProduct</code> class is now trying to do too much.
</p>
</blockquote>
</div>

<p>
The best approach is to think of a class as having a primary responsibility and to make that responsibility as singular and focused as possible. Describe a class's responsibility in 25 words or less, rarely using the words "and" or "or". 
</p>
</div>
</div>
<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Polymorphism</h3>
<div class="outline-text-3" id="text-5-3">
<p>
Polymorphism, or class switching, is the maintenance of <span class="underline">multiple implementations behind a common interface</span>.
</p>

<p>
The need for polymorphism is often signaled by the presence of extensive conditional statements. Polymorphism doesn't banish conditionals. It tends to centralize the conditional code into one place.
</p>
</div>
</div>
<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> Encapsulation</h3>
<div class="outline-text-3" id="text-5-4">
<p>
Encapsulation means the <span class="underline">hiding of data and functionality from client</span>.
</p>

<p>
The interface is what matters, not the mechanisms working beneath it. And the objective should be to make each part as independent as possible from its peers. 
</p>
</div>
</div>

<div id="outline-container-sec-5-5" class="outline-3">
<h3 id="sec-5-5"><span class="section-number-3">5.5</span> Forget How to Do It</h3>
<div class="outline-text-3" id="text-5-5">
<p>
At the design stage, empty your head of procedures and mechanisms. <span class="underline">Think only about the key participants of the system: the types it will need and their interfaces.</span> Let the structures and relationships in the code lead you. The implementation will fall into place easily behind a well-defined interface.
</p>

<p>
To emphasize interface, think in terms of abstract base classes rather than concrete children. It is this responsibility that is important about the type, not the actual persistence medium or the means of storing and retrieving data.
</p>
</div>
</div>

<div id="outline-container-sec-5-6" class="outline-3">
<h3 id="sec-5-6"><span class="section-number-3">5.6</span> Four Signposts</h3>
<div class="outline-text-3" id="text-5-6">
</div><div id="outline-container-sec-5-6-1" class="outline-4">
<h4 id="sec-5-6-1"><span class="section-number-4">5.6.1</span> Code Duplication</h4>
<div class="outline-text-4" id="text-5-6-1">
<p>
Duplication generally means tight coupling. If change something fundamental about one routine, will the similar routines need amendment? If this is the case, they probably belong in the same class.
</p>
</div>
</div>
<div id="outline-container-sec-5-6-2" class="outline-4">
<h4 id="sec-5-6-2"><span class="section-number-4">5.6.2</span> The Class Who Knew Too Much</h4>
<div class="outline-text-4" id="text-5-6-2">
<p>
limit a class's knowledge of its context. By using a global variable, or by giving a class any kind of knowledge about its wider domain, you anchor it into its context, making it less reusable and dependent on code beyond its control.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-5-7" class="outline-3">
<h3 id="sec-5-7"><span class="section-number-3">5.7</span> The UML [Skipped]</h3>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2017-09-16 Sat 19:54</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.5h)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
